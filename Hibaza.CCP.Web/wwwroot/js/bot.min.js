function introDoneClass(){$(".introjs-skipbutton").addClass("js-done")}function introSkipClass(){$(".introjs-skipbutton").removeClass("js-done")}function QR8bitByte(n){this.mode=QRMode.MODE_8BIT_BYTE;this.data=n}function QRCode(n,t){this.typeNumber=n;this.errorCorrectLevel=t;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}function QRPolynomial(n,t){var i,r;if(void 0==n.length)throw new Error(n.length+"/"+t);for(i=0;i<n.length&&0==n[i];)i++;for(this.num=new Array(n.length-i+t),r=0;r<n.length-i;r++)this.num[r]=n[r+i]}function QRRSBlock(n,t){this.totalCount=n;this.dataCount=t}function QRBitBuffer(){this.buffer=[];this.length=0}function URL(n){this.loadDataParams=function(t){void 0!==t&&(n+="?",n+=Object.keys(t).map(function(n){return[n,t[n]].map(encodeURIComponent).join("=")}).join("&"))};this.getURL=function(){return n}}function CloudService(){self.urls={brands:{stripe:{"delete":"/brands/stripe/delete/",save:"/brands/stripe/save/"},braintree:{"delete":"/brands/braintree/delete/",save:"/brands/braintree/save/"},subscriptions:{subscription_form:"/brands/subscriptions/subscription_form/",has_taxes:"/brands/subscriptions/has_taxes/",apply_promo_code:"/brands/subscriptions/check_code/"},views:{new_shortcut:"/shortcuts/new/",edit_shortcut:"/shortcuts/edit/"},data:{update_shortcut:apiURL+"brands/shortcuts/update/",add_shortcut:apiURL+"brands/shortcuts/create/",delete_shortcut:apiURL+"brands/shortcuts/delete/",get_shortcuts:apiURL+"brands/shortcuts/list/"},set_alert:"/brands/alert/",save_alert:"/brands/save_alert/",unassign:"/brands/unassign/",reports_html:"/reports/",reports:apiURL+"reports/",agents_top:apiURL+"reports/top_agents/",customers_top:apiURL+"reports/top_customers/",counters:"/brands/counters",webwidget:"/brands/webwidget/",save_logo:apiURL+"business/save_logo/",update:"/business/update/"},channels:{edit:"/channels/edit/","new":"/channels/new/",activate:"/channels/activate/",reload:"/channels/edit/",data:{get_all:apiURL+"brands/channels/list/",update:apiURL+"brands/channels/update/",create:apiURL+"brands/channels/create/",single:apiURL+"brands/channels/single/","delete":apiURL+"brands/channels/delete/"}},customers:{"new":"/customers/new",get_picture:"/customers/get_picture/",openprofile:"/customers/openprofile/",profile:"/customers/profile/",edit:"/customers/edit/",send_note:"/notes/send_customer_note/",remove_note:apiURL+"/notes/delete_customer_note/",assign:apiURL+"customers/assign/",assign_to:apiURL+"customers/assign/",unassign:apiURL+"customers/unassign/",last_ticket:"/tickets/last/",get:"/customers/get",get_send_files:"/customers/get_send_files/",block:apiURL+"/customers/block/",inner_note:"/customers/inner_note/",list:apiURL+"customers/list/",read:apiURL+"customers/read/",unread:apiURL+"customers/unread/",archive:"/customers/archive/",unarchive:"/customers/unarchive/",search:apiURL+"customers/search/",options:"/customers/option/",autoticket:"/customers/create_autoticket/"},threads:{list:apiURL+"threads/list/",get:apiURL+"threads/get/",read:apiURL+"threads/read/",unread:apiURL+"threads/unread/",profile:"/threads/profile/",last_visit:apiURL+"threads/last_visit/"},messages:{openlink:appURL+businessID+"/messages/openlink/",like:apiURL+"messages/like/",hide:apiURL+"messages/hide/",read:apiURL+"messages/read/",star:apiURL+"messages/star/",list:apiURL+"messages/list/",send:apiURL+"messages/send/",get:apiURL+"messages/get/","delete":apiURL+"messages/get/",send_files:apiURL+"messages/send_files/"},tickets:{add:"/tickets/add/",edit:"/tickets/edit/",send:"/tickets/send/",view:"/tickets/view/",set_short_description:apiURL+"tickets/set_short_description",set_description:apiURL+"tickets/set_description",set_status:apiURL+"tickets/set_status",edit_tags:apiURL+"tickets/edit_tags",profile:"/tickets/profile/",send_note:"/tickets/send_note/",edit_note:"/tickets/edit_note/",remove_note:"/tickets/remove_note/",attach:"/tickets/attach/",unattach:"/tickets/unattach/"},settings:{info:"/accounts/settings/",business:"/business/settings/",channels:"/channels/settings/",agents:"/agents/settings/",data:{update_account:apiURL+"brands/agents/update/"}},shinobi:{flights:{get_form:"/shinobi/flights/get_form/",options:"/shinobi/flights/get_options/"}},ronin:{load:"/ronin/load/",edit:"/ronin/edit/",save_mode:"/ronin/save_mode/",manager:"/ronin/manager/",request_bot:"/ronin/request_bot/",disable:"/ronin/disable/","delete":"/ronin/delete/"},agents:{profile:"/agents/get_agent_view",set_status:apiURL+"brands/agents/set_status/",edit:"/agents/edit/","new":"/agents/new/",register:apiURL+"brands/agents/register/",data:{get_all:apiURL+"brands/agents/list/",update:apiURL+"brands/agents/update/",create:apiURL+"brands/agents/create/",single:apiURL+"brands/agents/single/",admin:apiURL+"brands/agents/toogle_admin/","delete":apiURL+"brands/agents/delete/",save_avatar:apiURL+"brands/agents/save_avatar/",save_token:apiURL+"brands/agents/save_token/"}}};self.createURL=function(){var t="",n;for(arguments.length>0&&(t=arguments[0]),n=1;n<arguments.length;n++)t+="/"+arguments[n];return t}}function confirmMsgDel(n,t){var r=$deleteMessageDropdown.tmpl({key:t}),i=$(n).parent();i.append(r);i.on("hide.bs.dropdown",function(){i.find(".dropdown-menu").remove()})}function playAlert(n){audio.play();date=new Date;notificationsList.append(notificationTemplate.tmpl({date:date.getDate()+"/"+(date.getMonth()+1)+"/"+date.getFullYear()+" "+date.getHours()+":"+date.getMinutes(),message:n.message,tag:n.tag}));iconBell.addClass("js-alarm-active");$(".js-notifications-list li:nth-child(2)").remove();new NotificationPlugin(trAlert,n.message,"icon-bell")}function showNotification(n){new NotificationPlugin(n.title,n.message,n.icon)}function processNotification(n){n.type?"alert"==n.type?playAlert(n.data):"browser-notification"==n.type?playNotification(n.data):"qr"==n.type?modalQRCode(n.data):"notification"==n.type&&showNotification(n.data):playAlert(n)}function createListeners(){$(".js-invite-agent").click(function(){settingsUIRedirect="#agent-settings";$topBarSettings.trigger("click");cloud.loadSettingsAgents().done(function(){$(".js-show-edit-agent").not("[data-agent]").trigger("click")})});messageListContainer.on("click",function(n){("LI"==n.target.nodeName||"SECTION"==n.target.nodeName)&&txt.focus()});inputImage.on("change",function(n){var t,i;for($("#js-gallery-error-upload").addClass("hide"),$(".js-submit-image").prop("disabled",!1),modalImg.modal("show"),t=0;6>t;t++)imgSendFlags[t]=!1;i=n.target.files;i.length<=fileUploadLimit?$.each(i,function(n,t){var i=new FileReader;i.onload=function(t){$("<div>",{"class":"col-xs-4"}).append($("<a class='thumbnail' href='#' style='background-image: url("+t.target.result+")'><span class='js-thumbnail-close' data-index='"+n+"' href='#'>\u00d7<\/span><\/a>")).appendTo("#js-gallery-image-upload");imgSendFlags[n]=!0};i.readAsDataURL(t);i.onloadend=function(){$(".js-thumbnail-close").unbind("click");$(".js-thumbnail-close").bind("click",function(){var n=$(this).data("index"),t=$(this).parent().parent();imgSendFlags[n]=!1;t.remove()})}}):($("#js-gallery-error-upload").removeClass("hide"),$(".js-submit-image").prop("disabled",!0),inputImage.val(""))});buttonOpenGallery.click(function(n){preventDefault(n);modalImgGallery.hasClass("hidden")?modalImgGallery.removeClass("hidden"):modalImgGallery.addClass("hidden")});selectImgGallery.click(function(){modalImgGallery.addClass("hidden")});cancelImgGallery.click(function(){modalImgGallery.addClass("hidden")});resetImg.click(function(){sendForm[0].reset();modalImg.modal("hide");modalImgGallery.addClass("hidden")});modalImg.on("hidden.bs.modal",function(){$("#js-gallery-image-upload").html("");inputImage.val("")});modalShortcuts.on("shown.bs.modal",function(){$("#shortcuts-table").hide()});modalShortcuts.on("shown.bs.modal",function(){$("#shortcuts-table").tabulator("redraw",!0)});chatsSelect.click(chatFilterSelection);$(".js-chats-select span").click(function(){$topBarModals.trigger("hidden.bs.modal");$topBarChats.trigger("click")});chatsStatusSelect.click(function(n){preventDefault(n);selectClient.html($(this).children("span").text()+"<span class='caret'>");showTicketView(!1);contactStatusView=$(this).data("status");contactList.empty();cloud.loadContacts(0,limitContacts,chatView,chatViewAgent,chatViewChannel)});viewCurrentTicket.click(function(n){preventDefault(n);cloud.getTicketProfile(currentTicket);viewProfileTicket(currentTicket)});archiveCurrent.click(function(){var t=$(".js-status-select.selected"),n;if(t.size()>0&&(n=t.data("status"),"0"==n||"1"==n))return void $(this).find("a").attr("data-toggle","dropdown");$(this).find("a").attr("data-toggle","");CONTACTS[currentChat].archive()});archiveCurrentOption.click(function(){var n=$(this).data("status");"undefined"!=typeof n?cloud.setStatus(n).done(function(){CONTACTS[currentChat].archive();mixpanelEvents("changeTicketStatusArchive",STATUS[n])}):CONTACTS[currentChat].archive()});txt.on("focus",function(){currentChat&&"object"==typeof CONTACTS[currentChat]&&cloud.setReaded(currentChat)});unreadCurrent.click(function(n){preventDefault(n);THREADS[CONTACTS[currentChat].getKey()].unread()});openCurrent.click(function(n){preventDefault(n);window.open(self.urls.messages.openlink+"?item_id="+CONTACTS[currentChat].getKey(),"_blank")});$("#wz-modal-clients .wz-crm-menu li a").click(function(n){n.preventDefault();var t=$(this).attr("href");cloud.openSettings(t)});$leftNavigation.click(function(){$sideLeft1.hasClass("off")?$sideLeft1.removeClass("off"):$sideLeft1.addClass("off");$sideLeft2.hasClass("off")?$sideLeft2.removeClass("off"):$sideLeft2.addClass("off");$sideLeft3.hasClass("off")?$sideLeft3.removeClass("off"):$sideLeft3.addClass("off");$colCentral.hasClass("off")?$colCentral.removeClass("off"):$colCentral.addClass("off");$colSideright.hasClass("off")?$colSideright.removeClass("off"):$colSideright.addClass("off")});$topBarOption.click(function(){if(!$(this).hasClass("loaded")){$topBarOption.removeClass("loaded");$topBarModals.modal("hide");var n=$(this).find("a").attr("href");if("#"!=n){switch(n){case"#wz-modal-reports":cloud.getReports();break;case"#wz-modal-clients":cloud.openSettings();mixpanelEvents("openSettings");break;case"#wz-modal-automations":cloud.loadRoninModal();break;case"#wz-modal-ronin-manager":cloud.roninManager()}$(n).modal("show")}else tutorialActive&&$(".modal:visible").length<1&&welcomeModal.modal("show");$(this).addClass("loaded")}});$topBarModals.on("hidden.bs.modal",function(){var n=$(".js-topbar-option.active").find("a").attr("href"),t="#"+$(this).attr("id");n==t&&$topBarChats.trigger("click")});$addAgent.click(function(){"admin"==role&&(cloud.openSettings("#agent-settings").done(openSettingsModal),mixpanelEvents("addAgentClick"))});$addChannel.click(function(){"admin"==role&&(cloud.openSettings("#channel-settings").done(openSettingsModal),mixpanelEvents("addChannelClick"))});$("input[name='chat-search']").on("input propertychange paste",function(n){n.preventDefault();var t=$(this).val();t?($(".js-chat-date-subhead").fadeOut(),$(".js-chat-message-text:not(:Contains('"+t+"'))").parent().parent().fadeOut(),$(".js-chat-message-text:Contains('"+t+"')").parent().parent().fadeIn(),$(".js-chat-zami .js-chat-message-text:not(:Contains('"+t+"'))").parent().parent().parent().parent().fadeOut(),$(".js-chat-zami .js-chat-message-text:Contains('"+t+"')").parent().parent().parent().parent().fadeIn()):$(".js-chat-message, .js-chat-date-subhead").fadeIn()});$(".js-close-wz-finder").on("click",function(){$(".js-chat-message, .js-chat-date-subhead").fadeIn()});$(".js-disable-tutorial").on("click",disableTutorial);$(".js-welcome-panel .btn.btn-pink[data-channeltype]").bind("click",function(){var n=$(this).data("channeltype"),t=($(this).data("target"),$(this).hasClass("actived"));Object.keys(CHANNELS).length<=0?(settingsModal.removeClass("wz-modal-right").addClass("wz-modal-fullscreen modal-firstchannel"),"facebook"==n&&settingsModal.addClass("modal-facebook"),settingsModal.find(".modal-menu").hide()):(settingsModal.addClass("wz-modal-right").removeClass("wz-modal-fullscreen modal-firstchannel modal-facebook"),settingsModal.find(".modal-menu").show());settingsUIRedirect="#channel-settings";cloud.loadSettingsChannels().done(function(){$(".js-topbar-option").removeClass("loaded active");$(".js-topbar-settings").addClass("loaded active");$("#channels-main").addClass("hide");$("#channels-edit").removeClass("hide");settingsModal.modal("show");t?$("#channels-group ."+n+":first").parent().parent().find(".js-edit-channel").trigger("click"):$("#channels-addgroup ."+n).trigger("click")})});reportsModal.on("hide.bs.modal show.bs.modal",hideSideright);$(document).ajaxStart(function(){NProgress.inc()});$(document).ajaxStop(function(){NProgress.done()});$("#wz-modal-bots-contact .btn[data-step]").click(function(){var n=$(this).data("step"),t=$(this).data("cur-step");setBotsContactStep(n,t)});$("#wz-modal-bots-contact .textarea-2A, #wz-modal-bots-contact .textarea-2B").bind("input",function(){""==$(this).val()?$("#wz-modal-bots-contact .js-next-step").addClass("disabled"):$("#wz-modal-bots-contact .js-next-step").removeClass("disabled")});$("#wz-modal-bots-contact #js-bots-contact-submit").click(function(){var n=botDescription2A.val()||botDescription2B.val(),t=botDescription2A.val()?"Current chatbots management":"New chatbot request";setTimeout(function(){botDescription2A.val("");botDescription2B.val("");$("#wz-modal-bots-contact .js-next-step").addClass("disabled");setBotsContactStep("1")},200);cloud.roninRequest(n,t)})}function sendImageForm(){txt.val(txtImage.val());inputMessageTag.val(inputModalMessageTag.val());inputImageFlags.val(JSON.stringify(imgSendFlags));inputImageUrls.val(JSON.stringify(imgSendUrls));sendForm.submit();$("#js-gallery-image-upload").html("");imgSendUrls=[];inputImage.val("");txtImage.val("");inputMessageTag.val("");inputModalMessageTag.val("")}function resetChatview(){return chatViewAgent=!1,chatViewChannel="all",chatView="all",lastChatView=!1,$(".wz-col-sideleft-1 .js-tab-chats, .wz-filter li a").removeClass("active"),$('.wz-col-sideleft-1 .js-tab-chats[data-agent="all"]').addClass("active"),$('.wz-col-sideleft-1 .js-tab-chats[data-channel="all"]').addClass("active"),$(".wz-filter .js-select-all").addClass("active"),cloud.loadContacts(0,limitContacts,chatView,chatViewAgent,chatViewChannel)}function showTickets(){var t=getTicketsSelectorShow(),n=getTicketsSelectorHide();$(t).fadeIn();n&&$(n).fadeOut()}function noCustomersViewHandler(){contactList.find("li").size()>0?emptyCol02.hide():emptyCol02.show();contactList.find("li").size()>=limitContacts?fillerContactList.show():fillerContactList.hide()}function firstLoadAgents(){$.get(cloud.getURLs().agents.data.get_all,function(n){n.data&&n.data.forEach(function(n){$("li.js-agent-list[data-agent="+n.id+"]").removeClass("js-agent-online");$("li.js-agent-list[data-agent="+n.id+"]").removeClass("js-agent-offline");$("li.js-agent-list[data-agent="+n.id+"]").removeClass("js-agent-busy");$("li.js-agent-list[data-agent="+n.id+"]").addClass("js-agent-"+n.status.toLowerCase())})})}function getTicketsSelectorShow(){var n=".js-list-tickets li";return"assigned"==ticketAssignedView?n+="[data-agent='"+myID+"']":"unassigned"==ticketAssignedView&&(n+="[data-agent='']"),"all"!==ticketStatusView&&(n+="[data-status='"+ticketStatusView+"']"),"all"!==ticketResponsabilityView&&(n+="[data-responsability='"+ticketResponsabilityView+"']"),n}function getTicketsSelectorHide(){var n=".js-list-tickets li:not(";return"assigned"==ticketAssignedView?n+="[data-agent='"+myID+"']":"unassigned"==ticketAssignedView&&(n+="[data-agent='']"),"all"!==ticketStatusView&&(n+="[data-status='"+ticketStatusView+"']"),"all"!==ticketResponsabilityView&&(n+="[data-responsability='"+ticketResponsabilityView+"']"),n+=")",".js-list-tickets li:not()"!=n?n:!1}function loadTargetMessage(n,t){var i=$(t).data("message-key");return firebaseService.getMessage(CUSTOMER_ID,i).done(function(n){var u,r,f,o,s,h,c,l,e,a;n?(u=$(t).hasClass("wz-starred-message")?$(t).find(".wz-starred-text span"):$(t).hasClass("wz-last-message")?$(t).find(".wz-message-text span"):$(t).find(".wz-note-text span"),"text"==n.type||"note"==n.type?(u.text(n.message),linkifyElem(u)):"image"==n.type?(r=n.file_name||"[VIEW THE PHOTO]",0==r.length&&(n.file_name?r=n.file_name:n.url?(f=n.url.split("/"),r=f[f.length-1]):r="Photo"),o=$("<span>").text(r).addClass("wz-link wz-cursor-hand").append($("<i class='icon-paper-clip wz-font-c-light-gray-4'><\/i>")).on("click",function(){openImageUrl(n.url)}),u.append(o)):u.text(" "),s=formatShortDate(dateFromTimestamp(n.timestamp)),h=$(t).hasClass("wz-starred-message")?$(t).find(".wz-starred-date"):$(t).hasClass("wz-last-message")?$(t).find(".wz-message-date"):$(t).find(".wz-note-date"),h.text(s),$(t).attr("data-timestamp",n.timestamp),c=$(t).hasClass("wz-starred-message")?$(t).find(".wz-starred-jump"):$(t).hasClass("wz-last-message")?$(t).find(".wz-message-jump"):$(t).find(".wz-note-jump"),l=(n.agent_id===undefined||!n.agent_id)&&n.sender_ext_id!=n.channel_ext_id,(c.bind("click",function(){cloud.goToMessage(CUSTOMER_ID,i,n.timestamp)}),l===!0)?(e=function(){var n=CONTACTS[CUSTOMER_ID].getAvatar(),t;$(this).find(".js-picture").css("background-image","url("+n+")");$(this).find(".js-picture").addClass("js-picture-"+CUSTOMER_ID);t=CONTACTS[CUSTOMER_ID].getInitials();$(this).find(".js-initials p").text(t);$(this).find(".js-initials").addClass("js-initials-"+CUSTOMER_ID+" "+getAvatarColor(CUSTOMER_ID));-1!=n.indexOf("bot.png")&&($(this).find(".js-initials").removeClass("hide"),$(this).find(".js-picture").addClass("hide"));$(this).find(".wz-starred-author").text(CONTACTS[CUSTOMER_ID].getName());$(this).find(".wz-message-author").text(CONTACTS[CUSTOMER_ID].getName());$(this).find(".js-picture").parent().attr("data-toggle","tooltip").attr("data-original-title",CONTACTS[CUSTOMER_ID].getName())},CONTACTS[CUSTOMER_ID]?e.bind(t)():cloud.getContact(CUSTOMER_ID,!0).done(e.bind(t))):(a=AGENTS[n.agent_id]&&AGENTS[n.agent_id].avatar?AGENTS[n.agent_id].avatar:cloud.getMediaUrl()+"avatars/bot.png",AGENTS[n.agent_id]?$(t).find(".wz-ticket-avatar, .wz-note-avatar, .wz-starred-avatar, .wz-message-avatar").attr("data-toggle","tooltip").attr("data-original-title",AGENTS[n.agent_id].name):$(t).find(".wz-ticket-avatar, .wz-note-avatar, .wz-starred-avatar, .wz-message-avatar").attr("data-toggle","tooltip").attr("data-original-title",n.sender_name),$(t).find(".js-picture").addClass("js-picture-agent-"+n.agent_id).removeClass("hide"),$(t).find(".js-picture").css("background-image","url("+a+")"),$(t).find(".js-initials").remove(),AGENTS[n.agent_id]?$(t).find(".wz-starred-author").text(AGENTS[n.agent_id].name):$(t).find(".wz-starred-author").text(n.sender_name),AGENTS[n.agent_id]?$(t).find(".wz-message-author").text(AGENTS[n.agent_id].name):$(t).find(".wz-message-author").text(n.sender_name)),$(t).removeClass("js-loader-open")):$(t).remove()})}function viewProfileTicket(n){if(n){if(viewTicketSelected==n)return;viewTicketSelected=n}"ticket"!=viewProfile&&(viewProfile="ticket",viewAgentSelected=!1,viewPaymentSelected=!1,colSiderightTicket.show(),colSiderightClient.hide(),colSiderightPayment.hide(),colSiderightAgent.hide());mixpanelEvents("viewTicket")}function viewProfileClient(){"client"!=viewProfile&&(viewProfile="client",viewTicketSelected=!1,viewAgentSelected=!1,viewPaymentSelected=!1,colSiderightTicket.hide(),colSiderightPayment.hide(),colSiderightAgent.hide(),colSiderightClient.show())}function viewProfileAgent(n){if(n){if(viewAgentSelected==n)return;viewAgentSelected=n}"agent"!=viewProfile&&(viewProfile="agent",viewTicketSelected=!1,viewPaymentSelected=!1,colSiderightTicket.hide(),colSiderightClient.hide(),colSiderightPayment.hide(),colSiderightAgent.show())}function viewProfilePayment(n){if(n){if(viewPaymentSelected==n)return;viewPaymentSelected=n}"payment"!=viewProfile&&(viewProfile="payment",viewTicketSelected=!1,viewAgentSelected=!1,colSiderightTicket.hide(),colSiderightClient.hide(),colSiderightAgent.hide(),colSiderightPayment.show())}function removeSettings(){var n=function(n,t){$(t).hasClass("js-settings-suscription-opt")||$(t).remove()};$("#wz-modal-clients .modal-header .close").remove();$(".js-topbar-option").each(n);$("#wz-modal-clients").modal({keyboard:!1});$("#wz-modal-clients").modal("hide");searchContactContainer.css("visibility","hidden")}function saveBrand(){cloud.sendForm(document.getElementById("form-settings-brand"),cloud.getURLs().brands.update+businessID,function(n){n.view?settingsBrand.html(n.view):(cloud.loadSettingsBrand(),new NotificationPlugin(NP_DATA_SAVE.title,NP_DATA_SAVE.message,NP_DATA_SAVE.icon,null,null,NP_DATA_SAVE.countdown))})}function openSettingsModal(){$topBarOption.removeClass("loaded active");$topBarSettings.addClass("loaded active");settingsModal.modal("show")}function saveInfo(n){cloud.sendForm(document.getElementById("form-settings-info"),cloud.getURLs().settings.data.update_account+n,function(n){n.view?settingsUser.html(n.view):(cloud.loadSettingsInfo().done(cloud.reloadAgents()),new NotificationPlugin(NP_DATA_SAVE.title,NP_DATA_SAVE.message,NP_DATA_SAVE.icon,null,null,NP_DATA_SAVE.countdown))})}function saveAgent(n){void 0===n?cloud.sendForm(document.getElementById("form-settings-agent"),cloud.getURLs().agents.data.create+businessID,function(n){n.view?$("#agents-edit").html(n.view):(n.paid&&new NotificationPlugin(NP_PAYMENT.title,NP_PAYMENT.message,NP_PAYMENT.icon,null,null,NP_PAYMENT.countdown),cloud.loadSettingsAgents(),cloud.reloadAgents(),new NotificationPlugin(NP_DATA_SAVE.title,NP_DATA_SAVE.message,NP_DATA_SAVE.icon,null,null,NP_DATA_SAVE.countdown),$("#cancel-settings-agent").click(),mixpanelEvents("addAgent"))}):cloud.sendForm(document.getElementById("form-settings-agent"),cloud.getURLs().agents.data.update+businessID+"/"+n,function(n){n.view?$("#agents-edit").html(n.view):(cloud.loadSettingsAgents(),cloud.reloadAgents(),new NotificationPlugin(NP_DATA_SAVE.title,NP_DATA_SAVE.message,NP_DATA_SAVE.icon,null,null,NP_DATA_SAVE.countdown),$("#cancel-settings-agent").click(),mixpanelEvents("editAgent"))})}function saveChannelFacebook(n,t,i){typeof n!="undefined"&&n.length>0?cloud.sendForm(document.getElementById("channels-facebook-form"),cloud.getURLs().channels.data.update+i+"/"+n,function(n){n.view?$("#channels-edit").html(n.view):(refreshChannels(),mixpanelEvents("editFacebookChannel",t))}):cloud.sendForm(document.getElementById("channels-facebook-form"),cloud.getURLs().channels.data.create+"facebook/"+i,function(n){n.view?$("#channels-edit").html(n.view):(n.paid&&new NotificationPlugin(NP_PAYMENT.title,NP_PAYMENT.message,NP_PAYMENT.icon,null,null,NP_PAYMENT.countdown),0==cloud.getHowManyChannel()&&mixpanelEvents("addFirstChannel","Facebook"),refreshChannels(),mixpanelEvents("addFacebookChannel",t),tutorialActive&&($(".js-welcome-panel .btn.btn-pink[data-channeltype='facebook']").addClass("actived"),$topBarChats.trigger("click"),welcomeModal.modal("show"),$(".js-welcome-header").addClass("js-added"),addHow()))})}function refreshChannels(){return cloud.reloadChannels().done(cloud.loadSettingsChannels)}function refreshAgents(){return cloud.reloadAgents().done(cloud.loadSettingsAgents)}function restoreButton(n){var t=$(n);t.size()>0&&t.prop("disabled",!1)}function getAvatarColor(n){var t=n%AVATAR_COLOR.length;return t>=0&&t<AVATAR_COLOR.length?AVATAR_COLOR[t]:AVATAR_COLOR[0]}function refreshAgent(n){AGENTS[n]&&void 0!==AGENTS[n].avatar?($(".js-picture-agent-"+n).css("background-image","url("+cloud.getMediaUrl()+AGENTS[n].avatar+")"),$(".js-name-agent-"+n).text(AGENTS[n].name.capitalizeFirstLetter())):$(".js-picture-agent-"+n).css("background-image","url("+cloud.getMediaUrl()+"avatars/bot.png)")}function setClientInfoBtn(n,t,i){$selector=$(document).find(n);$selector.find(".status").html(t);$selector.find(".dropdown i").removeClass("assigned unassigned archived").addClass(i);$selector.removeClass("hide")}function showPaymentModal(){modalPaymentGenerator.modal("show")}function notificationBellClick(){$("#wz-dropdown-notifications").parent().hasClass("open")||mixpanelEvents("openNotifications")}function setAssignationListeners(n){if("object"==typeof CONTACTS[currentChat]){var t=CONTACTS[currentChat].getAssignButton();setClientInfoBtn(n,t.text,t["class"]);"assigned"==t["class"]?$(".js-unassign-footer").css("display","block"):($(".js-unassign-footer").css("display","none"),$(n+" .wz-search-popup ul li:last-child").css("border-bottom-left-radius","4px"),$(n+" .wz-search-popup ul li:last-child").css("border-bottom-right-radius","4px"))}$(".js-unassign-footer").click(function(){CONTACTS[currentChat].unassignMe()});$(n+" .dropdown a").click(function(){$(n+" .wz-search-popup").toggle();$(n+" .dropdown .caret ").toggleClass("up")});$(n+" .js-assign-title").click(function(){$(n+" .wz-search-popup div").toggle();$(n+" .js-assign-search input").focus()});$(n+" .js-assign-search i").click(function(){$(n+" .wz-search-popup div").toggle();$(n+" .js-assign-search input").val("");$(n+" .js-assign-search input").trigger("keyup")});$(n+" .js-assign-search input").keyup(function(){var t=$(this).val(),i=new RegExp(t,"ig");$(n+" .wz-search-popup ul li").each(function(){0==t.length||$(this).find("span").text().match(i)?$(this).fadeIn():$(this).fadeOut()})});loadSearchAgent(n)}function loadSearchAgent(n){var t=$(n+" .wz-search-popup ul");t.empty();$.each(Object.keys(AGENTS),function(i,r){if(AGENTS[r]&&AGENTS[r].name!=undefined){var u=$('<li  data-key="'+r+'">').append('<i class="'+AGENTS[r].status+'">').append("<span>"+AGENTS[r].name+"<\/span>");u.click(function(){var t=$(this).data("key");CONTACTS[currentChat].assignTo(t);$(n+" .wz-search-popup").toggle();$(n+" .dropdown .caret ").toggleClass("up")});t.append(u)}});$(n+" .js-assign-search input").trigger("keyup")}function openImageModal(n){$modalFullImage.find(".modal-body, .modal-header").on("click",function(n){"IMG"==n.target.nodeName?zoomImageElem($(n.target)):$modalFullImage.modal("hide")});$modalFullImage.find(".modal-body").empty();$modalFullImage.find(".modal-body").append(n);$modalFullImage.modal("show")}function openImageUrl(n){var t=$('<img class="wz-cursor-hand">').attr("src",n);openImageModal(t)}function openImageMessage(n,t){var i=firebaseService.getAttach(n,t);i.done(function(n){var t={key:n.id,val:function(){return n}},i=new Message(t);openImageModal(i.getRendered("image-full"))})}function putText(n){txt.val($(n).text());txt.focus()}function chatFilterSelection(n){n.preventDefault();$('.js-tab-chats[data-option="'+$(this).data("option")+'"]').removeClass("active");var t=$(this).data("option"),i=$(this).data("agent"),r=$(this).data("channel"),u=$('.js-tab-chats[data-option="agent"][data-agent="all"]');return $(this).parent().hasClass("panel-title")?$(".js-tab-chats[data-"+t+'="all"]').addClass("active"):$(this).addClass("active"),"agent"==t?"all"==i?(chatViewAgent=!1,$(".js-active a").text(trAssigned),$(".js-all a").text(trAll),$(".wz-filter li a").removeClass("active"),$(".js-all a").addClass("active"),chatView=!1,$(".js-active").fadeOut(200),$(".js-pending, .js-archived").fadeIn(200)):(chatViewAgent=i,chatView="active",$(".js-active").removeClass("hide").fadeIn(200),$(".js-pending, .js-archived").fadeOut(200,function(){$(".wz-filter li a").removeClass("active");$(".js-active a").addClass("active");$(".js-active a").html(AGENTS[i].name||trDeletedAgent)})):"channel"==t?chatViewChannel="all"==r?!1:r:"all"==t?(chatView=!1,0!=chatViewAgent&&(chatViewAgent=!1,$(".js-active a").text(trAssigned),$(".js-all a").text(trAll),$('.js-tab-chats[data-option="agent"]').removeClass("active"),u.addClass("active"),$(".js-active").removeClass("hide").fadeOut(200),$(".js-pending, .js-archived").fadeIn())):chatView=t,lastChatView=chatView,("agent"==t||"channel"==t)&&openContact.trigger("click"),contactList.empty(),(t=="channel"&&r=="all"||t=="agent"&&i=="all")&&$(this).parent().addClass("active"),cloud.loadContacts(0,limitContacts,chatView,chatViewAgent,chatViewChannel)}function showSideright(){reportsModal.addClass("wz-modal-cutted");$colSideright.addClass("wz-tweaked")}function hideSideright(){reportsModal.removeClass("wz-modal-cutted");$colSideright.removeClass("wz-tweaked");reportsModal.find(".tableContainer .selected").removeClass("selected");(viewAgentSelected||viewPaymentSelected)&&viewProfileClient()}function generateWidgetSnippet(n,t,i){var r="var __channel="+JSON.stringify(n)+";",u="var __agents="+JSON.stringify(t)+";",f="var __content="+JSON.stringify(i)+";";return'<script type="text/javascript">'+'!function(a,b,c,d,e,f,g){a.WebWidget=e,a[e]=a[e]||function(){(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","/js/webwidget-1.1.min.js","webwidget");'.concat(r,u,f,"webwidget(__channel, __agents, __content);")+"<\/script>"}function initPerfectScroll(){$sideleft1Scroll.perfectScrollbar({suppressScrollX:!0,wheelPropagation:!0});$sideleft2Scroll.perfectScrollbar({suppressScrollX:!0,wheelPropagation:!0});$sideleft3Scroll.perfectScrollbar({suppressScrollX:!0,wheelPropagation:!0});$centralScroll.perfectScrollbar({suppressScrollX:!0,wheelPropagation:!0});$siderightScroll.perfectScrollbar({suppressScrollX:!0,wheelPropagation:!0})}function format0Value(n){return 10>n?"0"+n:""+n}function getDateFromTimestamp(n){0>n&&(n*=-1);var t=new Date(1e3*n),i=t.getFullYear(),r=["January","February","March","April","May","June","July","Augaust","September","October","November","December"][t.getMonth()],u=t.getDate(),f=t.getHours(),e=t.getMinutes(),o=t.getSeconds();return u+"/"+r+"/"+i+" "+f+":"+e+":"+o}function getMonthName(n){if("number"!=typeof n||0>n||n>11)return!1;return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n]}function formatShortDatetime(n){return n.getMonth()+1+"/"+n.getDate()+" "+format0Value(n.getHours())+":"+format0Value(n.getMinutes())}function formatShortTime(n){return format0Value(n.getHours())+":"+format0Value(n.getMinutes())}function formatDateYYMD(n){var i=n.getMonth()+1,t;return 1==i.toString().length&&(i="0"+i),t=n.getDate(),1==t.toString().length&&(t="0"+t),n.getFullYear()+"-"+i+"-"+t}function getMonthLastDay(n){return new Date(n.getFullYear(),n.getMonth()+1,0)}function getMonthFirstDay(n){return new Date(n.getFullYear(),n.getMonth(),1)}function formatShortDate(n,t){var u;this.returnDateFormat=t;var r=new Date,f=new Date(r.getFullYear(),r.getMonth(),r.getDate()),i=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear();return this.returnDateFormat||(u=daydiff(n,f),0>=u?i=trToday:1==u?i=trYesterday:(i=getMonthName(n.getMonth())+" "+n.getDate()+"th",n.getFullYear()!=r.getFullYear()&&(i+=", "+n.getFullYear()))),i}function dateFromTimestamp(n){return new Date(1e3*Math.abs(n))}function daydiff(n,t){return Math.round((t-n)/864e5)}function setShortcuts(n,t){n.bind("keyup",function(i){13!=i.keyCode||i.shiftKey||(i.altKey?n.val(n.val()+"\n"):(i.preventDefault(),t.submit()))});n.bind("keypress",function(n){13!=n.keyCode||n.shiftKey||n.preventDefault()})}function sortContacts(){function n(n,t){return $(t).attr("timestamp")>$(n).attr("timestamp")?1:-1}$(".js-load-more").size()>0?$(".js-list-contacts li").sort(n).insertBefore($(".js-load-more")):$(".js-list-contacts li").sort(n).appendTo(".js-list-contacts")}function sortStarredMessages(){function n(n,t){return $(t).data("timestamp")>$(n).data("timestamp")?1:-1}$(".js-ticket-starred .wz-starred-message").sort(n).appendTo($(".js-ticket-starred "))}function sortTicketsInverse(){var n=$(".js-ticket-view");for(i=0;i<n.length;i++)$("#wz-tab-pedidos").prepend($(n[i])),$(n[i]).removeClass("hidden")}function createSwitch(n,t){var i="wz-switch-active",r="wz-switch-inactive";if("string"!=typeof n)throw new TypeError("createSwitch(): First arg must be a String.");if("function"!=typeof t)throw new TypeError("createSwitch(): Second arg must be a Function.");$(n).click(function(){$(this).hasClass(r)&&($(n+"."+i).removeClass(i).addClass(r),$(this).removeClass(r).addClass(i));t(this)})}function logError(n,t,i){var r="["+trError+"]"+n;t&&(r+=" @ "+t);i&&(r+=":"+i);console.log(r)}function removeClassByRegExp(n,t){var u=n.attr("class");if("string"==typeof u){for(var r=u.split(/\s+/),f=[],i=0;i<r.length;i++)r[i].match(t)||f.push(r[i]);n.attr("class",f.join(" "))}}function getClassByName(n,t){for(var r=n.attr("class").split(/\s+/),i=0;i<r.length;i++)if(r[i].match(t))return r[i];return""}function createSomeZamiMessages(n,t,i){var s=/\@hibaza\.com$/;if(!s.test(email)||!s.test(n))return messageZamiLastChat=currentChat,!1;if(messageZamiLastChat==currentChat)return!1;messageZamiTimestamp||(messageZamiTimestamp=Date.now()/1e3);var r=messageZamiTimestamp,f=dateFromTimestamp(r),e=new Date(formatShortDate(f,!0)),o="js-day-"+formatShortDate(f,!0).replace(/\//g,"-"),u=e.getTime()/1e3;if(MESSAGES["zami"+u]=new Message({key:function(){return"zami"+u},val:function(){return{chat:currentChat,message:trHeyCustomer+CONTACTS[currentChat].getName()+trHasStarted,author:0,date:u,day:e,dayClass:o,timestamp:r,agent:1,read:!0,type:"zami",button_class_1:"hide",button_class_2:"hide"}},ref:function(){return $("<div>")}}),MESSAGES["zami"+u].render(),t&&$.each(t,function(n,t){if(""!=t&&"None"!=t){r+=.1;var u=dateFromTimestamp(r),f=new Date(formatShortDate(u,!0)),e="js-day-"+formatShortDate(u,!0).replace(/\//g,"-"),i=f.getTime()/1e3;MESSAGES["zami"+i]=new Message({key:function(){return"zami"+i},val:function(){return{chat:currentChat,message:CONTACTS[currentChat].getName()+trHasSet+n+trTo+"*"+t+"*.",author:0,date:i,day:f,dayClass:e,timestamp:r,agent:1,read:!0,type:"zami",button_class_1:"hide",button_class_2:"hide"}},ref:function(){return $("<div>")}});MESSAGES["zami"+i].render()}}),i){r+=.1;var f=dateFromTimestamp(r),e=new Date(formatShortDate(f,!0)),o="js-day-"+formatShortDate(f,!0).replace(/\//g,"-"),u=e.getTime()/1e3;MESSAGES["zami"+u]=new Message({key:function(){return"zami"+u},val:function(){return{chat:currentChat,message:trHey+firstName+"! "+CONTACTS[currentChat].getName()+trDemands+" *"+i.name+"*. "+trIVeCreated,author:0,date:u,day:e,dayClass:o,timestamp:r,agent:1,read:!0,type:"zami",button_class_1:"btn-white-pink",button_text_1:trViewTicket,button_click_1:"cloud.getTicketProfile("+i.id+", [viewProfileTicket]);",button_class_2:"btn-white-pink",button_text_2:trSendPayment,button_click_2:"cloud.getTicketProfile("+i.id+", [viewProfileTicket, cloud.getPaymentForm, showPaymentModal]);"}},ref:function(){return $("<div>")}});MESSAGES["zami"+u].render()}scrollMessages();firebaseService.sortMessages("."+o);messageZamiLastChat=currentChat}function zoomImageElem(n){window.open(n.attr("src"))}function clearAccents(n){var t=n.replace(/[\u00e1\u00e0\u00e4\u00e2]/g,"a");return t=t.replace(/[\u00c1\u00c0\u00c4\u00c2]/g,"A"),t=t.replace(/[\u00e9\u00e8\u00eb\u00ea]/g,"e"),t=t.replace(/[\u00c9\u00c8\u00cb\u00ca]/g,"E"),t=t.replace(/[\u00ed\u00ec\u00ef\u00ee]/g,"i"),t=t.replace(/[\u00cd\u00cc\u00cf\u00ce]/g,"I"),t=t.replace(/[\u00f3\u00f2\u00f6\u00f4]/g,"o"),t=t.replace(/[\u00d3\u00d2\u00d6\u00d4]/g,"O"),t=t.replace(/[\u00fa\u00f9\u00fc\u00fb]/g,"u"),t=t.replace(/[\u00da\u00d9\u00dc\u00db]/g,"U"),t=t.replace(/\u00f1/g,"n"),t=t.replace(/\u00d1/g,"N")}function getInitials(n){var i="?";if("string"==typeof n&&n.length>0)for(var i="",u=clearAccents(n).toUpperCase(),r=u.replace(/\W/g," ").replace(/\s+/g," ").split(" "),t=0;t<r.length&&2>t;t++)i+=r[t].charAt(0);return i}function preventDefault(n){n.preventDefault()}function preventPaste(n){document.execCommand("insertText",!1,n.originalEvent.clipboardData.getData("text"));n.preventDefault()}function preventIntro(n){var t=n.keyCode||n.which;13==t&&n.preventDefault()}function stopPropagation(n){n.stopPropagation()}function showDefaultErrorNotification(){new NotificationPlugin(trError,trAnErrorOcurred,"icon-cross")}function checkFormChanges(){""==$.trim($(this).val())?$(this).addClass("error"):$(this).removeClass("error")}function checkFormElements(n){var t=!0;return $(n).find("input.form-control, select.form-control").removeClass("error").off("change",checkFormChanges),$(n).find("input.form-control, select.form-control").each(function(n,i){var r=$(i);""==$.trim(r.val())&&(r.addClass("error"),r.on("change",checkFormChanges),t=!1)}),t}function copyToClipboard(n){var r=n.data.shareValue||$(this).data("share-value"),t=n.data.valueType||$(this).data("value-type"),u=n.data.shareValueHide||!1,i=$("<input>").val(r);i.appendTo($("body"));i.select();document.execCommand("copy");u?new NotificationPlugin(t+trCopied,trYour+" "+t+"  "+trHasBeenCopied,"icon-clipboard",null,null,longNotificationTimer):new NotificationPlugin(t+trCopied,trYour+" "+t+" ("+r+") "+trHasBeenCopied,"icon-clipboard",null,null,longNotificationTimer);i.remove()}function validateCIF(n){var t,e,u,r,a,v;if("string"==typeof n&&9==n.length){if(t=n.toUpperCase(),e="ABCDEFGHJNPQRSUVW",-1!=e.indexOf(t[0])&&/^\d{2}$/.test(t.slice(1,3))&&!/^(00)$/.test(t.slice(1,3))&&/^\d{5}$/.test(t.slice(3,8))){var o=t.slice(1,8),s=0,h=0;for(i=0;i<o.length;i++)u=parseInt(o[i]),u>0&&(i%2!=0?s+=u:i%2==0&&(r=(2*u).toString(),r.length>1&&(r=parseInt(r[0])+parseInt(r[1])),h+=parseInt(r)));var c=(s+h).toString(),l=parseInt(c[c.length-1]),f=0;return 0!=l&&(f=10-l),a="JABCDEFGHI",v=a.charAt(f),t[8]==v||t[8]==f?!0:!1}return!1}return!1}function addOrUpdateUrlParam(n,t,i){var r=new RegExp("([?&])"+t+"=[^&#]*","i"),u;return r.test(n)?n=n.replace(r,"$1"+t+"="+i):(u=/\?/.test(n)?"&":"?",n=n+u+t+"="+i),n}function changeStatus(){onlineStatus="online"==onlineStatus?"busy":"online";cloud.changeStatus(onlineStatus).fail(showDefaultErrorNotification).done(function(){refreshAgentStatus(myID,onlineStatus);mixpanelEvents("operatorStatus")})}function updateStatus(n){n=="offline"?window.location.href="/login":"online"==n?($(".wz-operator-status").removeClass("busy").removeClass("offline"),$(".wz-status-text").html(trBusy+'<i class="pull-right icon-ban"><\/i>')):"offline"==n?$(".wz-operator-status").addClass("offline"):"busy"==n&&($(".wz-operator-status").addClass("busy"),$(".wz-status-text").html(trActivate+'<i class="pull-right icon-reload"><\/i>'))}function refreshAgentStatus(n,t){var i=t.toLowerCase();n==myID&&updateStatus(i);void 0===AGENTS[n]&&(AGENTS[n]={},cloud.reloadAgents());AGENTS[n].status=i;$("li.js-agent-list[data-agent="+n+"]").removeClass("js-agent-online");$("li.js-agent-list[data-agent="+n+"]").removeClass("js-agent-offline");$("li.js-agent-list[data-agent="+n+"]").removeClass("js-agent-busy");$("li.js-agent-list[data-agent="+n+"]").addClass("js-agent-"+i);loadSearchAgent("#client-status");loadSearchAgent(".wz-col-central footer .assignation")}function autoSizeTextarea(){txt.addClass("txtstuff");hiddenDiv.addClass("hiddendiv common");hiddenDiv.css("width",txt.width());$("body").append(hiddenDiv);txt.on("keyup",function(){content=$(this).val();content=content.replace(/\n/g,"<br>");hiddenDiv.html(content+'<br class="lbr">');$(this).css("height",hiddenDiv.height()+20)})}function emojiPicker(){$emojiBtn.emojiPicker({height:"300px",width:"450px",inputId:"js-typearea"})}function showGhostChat(n,t){var r=txt.val(),u,i;return r.length>0?(u=formatShortTime(new Date),i=$(".js-loadtemplate-ghost").tmpl({avatar:n,name:t,date:u,message:r}),$(i).find(".js-resend-message").on("click",function(){$(this).parent().parent().parent().remove();setTimeout(function(){var n=$(this).parent().parent().find(".js-chat-message-text").text();txt.val($.trim(n));sendMessage(sendForm);txt.val("")}.bind(this),500)}),$(i).find(".js-remove-message").on("click",function(){$(this).parent().parent().parent().remove()}),chatList.append(i),scrollMessages(),txt.css("height","42px"),i):!1}function hideGhostChat(){$(".js-chat-ghost").remove()}function initFirebase(){var n=new $.Deferred,t,i;return FIREBASE_APP=firebase.initializeApp(firebaseConfig,"hibaza"),firebaseService=new FirebaseService(FIREBASE_APP.database().ref(businessID)),cloud=new CloudService,cloud.setMediaUrl(mediaURL),t=function(){var t=contactList.find("li").first().data("key");t&&firebaseService.setChat(t);cloud.getLastTicket(t);refreshChannels();refreshAgents();n.resolve()},i=cloud.loadContacts(0,limitContacts,chatView,chatViewAgent,chatViewChannel),$.when(i).done(t),showTicketList.on("click",function(){cloud.getTicketList()}),firebaseService.registerUpdates(),n.promise()}function initReports(){reportManager=new ReportManager;dashboardManager=new DashboardManager;Chart.defaults.global.defaultFontColor="#FFFFFF";Chart.defaults.global.defaultFontFamily='"Gotham Rounded", sans-serif, Helvetica, Arial, sans-serif';Chart.defaults.global.animation.duration=800;Chart.defaults.global.legend.labels.boxWidth=12;Chart.defaults.global.legend.labels.fontStyle="bold";moment.locale(LOCALE_LANGUAGE);$.get(cloud.getURLs().brands.customers_top+businessID,function(n){reportManager.topTenCustomers=n});$.get(cloud.getURLs().brands.agents_top+businessID,function(n){reportManager.topTenAgents=n;var t=[];n.lines&&$.each(n.lines,function(i){t.push(n.lines[i].id)});dashboardManager.topTenAgents=t})}function setDateValues(n){$("#wz-modal-reports .js-filter-date-init").val(n.init);$("#wz-modal-reports .js-filter-date-selector-init").val(n.initText);$("#wz-modal-reports .js-filter-date-finish").val(n.finish);$("#wz-modal-reports .js-filter-date-selector-finish").val(n.finishText);$("#wz-modal-reports .js-filter-date-text").text(n.initText+" - "+n.finishText);$("#wz-modal-reports .dropdown-date .dropdown-toggle").removeClass("pick")}function getDateRange(n){var t,i,r=n;switch(n){case"today":t=moment().startOf("day");i=moment();break;case"c_week":t=moment().startOf("week");i=moment();break;case"c_month":t=moment().startOf("month");i=moment();break;case"l_month":t=moment().subtract(1,"months").startOf("month");i=moment().subtract(1,"months").endOf("month");break;case"c_year":t=moment().startOf("year");i=moment();break;default:r="c_year";t=moment().startOf("year");i=moment()}return{id:r,init:t.valueOf(),initText:t.format(DATE_FORMAT),finish:i.valueOf(),finishText:i.format(DATE_FORMAT)}}function introJsAssignate(){var n=".js-list-contacts .wz-flex-card.active",t="bottom-left-aligned";0==$(n).size()&&(n="#client-status .dropdown",t="bottom-right-aligned");intro&&intro.exit();intro=introJs();intro.setOptions({disableInteraction:!1,exitOnOverlayClick:!0,steps:[{element:n,intro:trYouNeed,position:t}]});$("#wz-modal-upload-image.fade.in").length>0?($("#wz-modal-upload-image").modal("hide"),$("#wz-modal-upload-image").on("hidden.bs.modal",function(){intro.start()})):intro.start()}function introJsNewInterface(){intro&&intro.exit();intro=introJs();intro.onexit(function(){$("#intercom-container").show()});var n=trHereIs;"admin"==role&&(n+="<br><br><u>"+trProTip+"<\/u>: "+trIfYouWant);intro.setOptions({disableInteraction:!1,exitOnOverlayClick:!0,steps:[{step:1,element:".wz-col-sideleft-1.wz-col-height",intro:n,position:"right"},{step:2,element:".wz-topbar .wz-col-central",intro:trThisIs,position:"bottom-right-aligned"},{step:3,element:".wz-col-sideleft-2 header",intro:trYouCanFilter,position:"right"}]});$("#intercom-container").hide();intro.start();$(".introjs-tooltip").css("top","120px")}function introJsNewTextarea(){intro&&intro.exit();intro=introJs();intro.onbeforechange(function(){shorcutBtnContainer.addClass("introjs-fixParent");checkNote.hasClass("js-checked")&&checkNote.trigger("click")});intro.onafterchange(function(){shorcutBtnContainer.addClass("introjs-fixParent")});intro.onexit(function(){shorcutBtnContainer.removeClass("introjs-fixParent");$("#intercom-container").show()});var n=trFastResponses;1==shorcutBtnContainer.find(".btn").length&&(n+="<br><br>"+trSetYourFirst);intro.setOptions({disableInteraction:!1,exitOnOverlayClick:!0,steps:[{step:1,element:"#send_form",intro:trThisIsOur,position:"top"},{step:2,element:".shortcuts",intro:n,position:"top"},{step:3,element:"#js-button-checknote",intro:trIfYouCheck,position:"top"}]});$("#intercom-container").hide();shorcutBtnContainer.addClass("introjs-fixParent");setTimeout(function(){intro.start()},200)}function introJsNewTickets(){intro&&intro.exit();intro=introJs();intro.onexit(function(){$("#intercom-container").show()});intro.onafterchange(function(){$(".js-client-view[data-view=tickets]").trigger("click")});intro.onbeforechange(function(){$(".js-client-view[data-view=tickets]").trigger("click")});intro.setOptions({disableInteraction:!1,exitOnOverlayClick:!0,steps:[{step:1,element:".js-last-ticket",intro:trEachTime,position:"bottom"},{step:2,element:"#wz-col-sideright .wz-sideright-client .wz-central",intro:trYouCanView,position:"left"},{step:3,element:'.js-ticket-view[data-ticket="'+currentTicket+'"]',intro:trClickOnTicket,position:"left"}]});$("#intercom-container").hide();intro.start()}function introJsNewTicketView(){intro&&intro.exit();intro=introJs();intro.onexit(function(){$("#intercom-container").show()});intro.setOptions({disableInteraction:!1,exitOnOverlayClick:!0,steps:[{step:1,element:".wz-sideright-ticket .wz-ticket-header",intro:trYouCanEdit,position:"left"},{step:2,element:".wz-sideright-ticket .wz-ticket-body",intro:trYouCanAlsoView,position:"left"}]});$("#intercom-container").hide();intro.start()}function linkify(n){return n.html(function(){return $(this).find(".js-chat-message-email").each(function(){$(this).html($(this).html().replace(/(\S+)(\s+)(\&lt;)((http|https|ftp):\/\/[\w?=&\/-;#~%-]+(\.[\w?=&\/-;#~%-]+)*(?![\w\s?&.\/;#~%"=-]*>))(\&gt;)/gm,'<a href="$4" class="wz-link" target="_blank">$1<\/a>').replace(/(\n){3,}/g,"\n\n"))}),$(this).find(".js-chat-message-text").each(function(){$(this).html(linkifyString($(this).html()))}),$(this).html()})}function linkifyString(n){return n?n.replace(/^(.*[\s\w])?((http|https|ftp):\/\/[\w?=&\/-;,#~%-]+(\.[\w?=&\/-;,#~%-]+)*(?![\w\s?&.\/;,#~%"=-]*>))/gm,'$1<a href="$2" class="wz-link" target="_blank">$2<\/a>'):""}function linkifyElem(n){n.html(linkifyString(n.html()))}function strongify(n){return n.html(function(){return $(this).find(".js-chat-zami-text").each(function(){$(this).html($(this).html().replace(/(\*)([\S ]+)(\*)/gm,"<strong>$2<\/strong>"))}),$(this).html()})}function loadStylesheet(n){var i=new $.Deferred,t=document.createElement("style"),r;return t.textContent='@import "'+n+'"',r=setInterval(function(){try{t.sheet.cssRules;i.resolve();clearInterval(r)}catch(n){}},250),document.head.appendChild(t),i.promise()}function initMixpanel(){}function mixpanelEvents(){}function modalCRMTable(){var n=$("#wz-modal-tickets");n.on("shown.bs.modal",function(){$(".modal-backdrop").addClass("js-modal-tickets")})}function modalClientsTable(){var n=($("#wz-table-clients"),$("#wz-modal-tickets"));$("#wz-acc-h-01,#wz-acc-h-02");n.on("shown.bs.modal",function(){$(".modal-backdrop").addClass("js-modal-tickets")})}function modalDismiss(){$(".modal").on("shown.bs.modal",function(){$(document).off("focusin.modal")});var n=$(".js-tab-chats");return n.click(function(){$(".modal").modal("hide")}),$(".modal").on("show.bs.modal",function(){var n;n=this;1!=$(this).data("modal-stack")&&$(".modal").each(function(){this!==n&&$(this).modal("hide")})})}function modalTicketsTable(){var n=$("#js-open-modal-tickets"),t=$("#wz-modal-tickets");n.click(function(){t.modal("show")});ticketSelect.on("click",function(n){n.preventDefault();$(this).hasClass("active")?($(this).removeClass("active"),$(this).parent().toggleClass("active")):($(this).parent().parent().find(".active").removeClass("active"),$(this).toggleClass("active"),$(this).parent().toggleClass("active"));var i=$(this).data("filter"),t=$(this).data("option");switch(i){case"assigned":ticketAssignedView=ticketAssignedView==t?"all":t;break;case"responsability":ticketResponsabilityView=ticketResponsabilityView==t?"all":t;break;case"status":ticketStatusView=ticketStatusView==t?"all":t}})}function modalPricing(){changeBilledPeriod($(".js-pricing-switch.wz-switch-active").get());pricingModal.css("display","block");createSwitch(".js-pricing-switch",changeBilledPeriod);pricingSelectPlan.click(function(){pricingPeriodSelected=$(".js-pricing-switch.wz-switch-active").data("period");cloud.openSettings("#suscription-settings",cloud.loadSettingsSuscriptionForm).done(function(){pricingModal.modal("hide");settingsModal.modal("show")})});pricingModal.modal("show")}function modalQRCode(n){var t,i,r;CHANNELS[n.channel_id]?(t=CHANNELS[n.channel_id].type,i=CHANNELS[n.channel_id].name+"("+n.channel_phone+")"):(t="whatsapp",i=n.channel_phone);QRCodeModal.modal("show");QRCodeModal.css("display","block");r=/icon-/g;removeClassByRegExp(QRCodeChannelIcon,r);QRCodeChannelIcon.addClass("icon-"+t);QRCodeChannelName.html(i);QRCodeContainer.empty();QRCodeContainer.qrcode(n.code);QRCodeModalClose.click(function(){QRCodeSuccess();QRModalPreloader.modal("show")})}function QRCodeSuccess(){QRModalPreloading.addClass("hide");QRModalSuccess.removeClass("hide")}function QRCodeReset(){QRModalPreloading.removeClass("hide");QRModalSuccess.addClass("hide")}function modalNotification(n){n&&("string"==typeof n.icon?(removeClassByRegExp($notificationModalIcon,/^icon-/),$notificationModalIcon.addClass(n.icon)):$notificationModalSection.hide(),"string"==typeof n.title?$notificationModalTitle.text(n.title):($notificationModalTitle.hide(),$notificationModalSeparator.hide()),"string"==typeof n.message?$notificationModalMessage.text(n.message):$notificationModalMessage.hide(),"boolean"==typeof n.close&&(n.close||$notificationModalCloseIcon.hide()),$notificationModalButtons.empty(),"object"==typeof n.buttons&&$.each(n.buttons,function(t){var i=$("<i class='icon-arrow-right'>"),r=$("<strong>").text(n.buttons[t].text),u=$("<span>").append(r).append(i),f=$("<a class='btn btn-block'>").addClass(n.buttons[t]["class"]).click(n.buttons[t].callback).append(u);$notificationModalButtons.append(f)}),$notificationModal.modal("show"))}function renderAllNotificationPlugin(){for(var r,t=12,i=t,n=0;n<notificationArray.length;n++)n>0&&(r=parseFloat(notificationArray[n-1].elem.outerHeight(!0)),i+=r+t),notificationArray[n].elem.css("top",i+"px")}function deleteNotificationPlugin(n){for(var t=0;t<notificationArray.length;t++)if(notificationArray[t].id===n.id){notificationArray.splice(t,1);break}renderAllNotificationPlugin()}function notifications(){iconBell.on("click",function(){$(this).removeClass("js-alarm-active")})}function notifyMe(n,t){if("Notification"in window)if("granted"===Notification.permission){var r={body:t,icon:cloud.getMediaUrl()+n.avatar,dir:"ltr"},i=new Notification(n.name,r);i.onclick=function(){firebaseService.setMainChat(n.id);window.focus()};setTimeout(i.close.bind(i),2e3)}else"denied"!==Notification.permission&&Notification.requestPermission(function(i){if("permission"in Notification||(Notification.permission=i),"granted"===i){var u={body:t,icon:cloud.getMediaUrl()+n.avatar,dir:"ltr"},r=new Notification(n.name,u);r.onclick=function(){firebaseService.setMainChat(n.id);window.focus()};setTimeout(r.close.bind(r),2e3)}});else console.log("This browser does not support desktop notification")}function loadOldContacts(){contactListContainer.stop();clearTimeout(timeoutUiAutoLoadContacts);timeoutUiAutoLoadContacts=!1;contactListContainer.bind("scroll",uiAutoLoadContacts)}function getContactListHeight(){var n=contactListContainer.find(".js-filler-contact").outerHeight()+contactListContainer.find(".js-list-contacts").outerHeight();return"none"!=olderContactsLoader.css("display")&&(n+=olderContactsLoader.outerHeight()),n}function getContactTop(){var n=contactListContainer.scrollTop()+contactListContainer.first().outerHeight();return n>=getContactListHeight()-contactListContainer.height()&&(n=getContactListHeight()-contactListContainer.height()-5),n}function uiAutoLoadContacts(){var r=$(".js-list-contacts li").size(),f=$(".js-list-contacts li.js-search").size(),u=contactListContainer.scrollBottom()>=lastContactScroll,n,t,i;lastContactScroll=contactListContainer.scrollBottom();n=contactListContainer.scrollBottom()>=getContactListHeight();t=cloud.getMediaUrl()+"avatars/bot.png";($(".js-see-older-contacts .wz-contact-avatar").css("background-image","url("+t+")"),n&&u)&&(NProgress.inc(),olderContactsLoader.fadeIn(800),contactListContainer.animate({scrollTop:getContactTop()},800,"swing",function(){$sideleft2Scroll.perfectScrollbar("update")}),i=808,timeoutUiAutoLoadContacts=setTimeout(function(){var n=$(".js-list-contacts li").last(),t=n&&n.length>0?n.attr("timestamp"):0;r>=limitContacts||!0?(lc=cloud.loadContacts(t,limitContacts,chatView,chatViewAgent,chatViewChannel),lc&&lc.done(function(){$sideleft2Scroll.perfectScrollbar("update");olderContactsLoader.fadeOut(500,"swing",function(){timeoutUiAutoLoadContacts=!1;NProgress.done();clearTimeout(timeoutUiAutoLoadContacts)},function(){$sideleft2Scroll.perfectScrollbar("update")})})):olderContactsLoader.fadeOut(500,"swing",function(){timeoutUiAutoLoadContacts=!1;NProgress.done();clearTimeout(timeoutUiAutoLoadContacts)},function(){$sideleft2Scroll.perfectScrollbar("update")})},i))}function loadOldMessages(){messageListContainer.stop();olderMessagesLoader.removeClass("js-loader-open");clearTimeout(timeoutUiAutoScrollMessages);clearTimeout(timeoutUiAutoLoadMessages);clearInterval(intervalUiAutoScrollMessages);timeoutUiAutoScrollMessages=!1;timeoutUiAutoLoadMessages=!1;intervalUiAutoScrollMessages=!1;messageListContainer.bind("scroll",uiAutoLoadMessages)}function scrollToFirstMessage(){intervalUiAutoScrollMessages||(intervalUiAutoScrollMessages=setInterval(function(){if(chatList.children().size()>howManyMessages){chatList.find("li:hidden").fadeIn(1500);var n=getMessageTop(lastMessageToScroll);messageListContainer.scrollTop(n);$centralScroll.perfectScrollbar("update");n>400?n-=400:n=10;timeoutUiAutoScrollMessages=setTimeout(function(){messageListContainer.stop().animate({scrollTop:n},"500","swing",function(){})},200);clearInterval(intervalUiAutoScrollMessages);intervalUiAutoScrollMessages=!1}},100))}function getMessageTop(n){var t=n.offset().top;return t-=n.hasClass("js-chat-groupped")?55:70,n.prev()&&n.prev().hasClass("js-chat-date-subhead")&&(t-=n.prev().outerHeight()),10>t&&(t=10),t}function isScrolledIntoView(){var n=messageListContainer.scrollTop(),t=n<lastMessageScroll,i=0==n;return lastMessageScroll=n,t&&i}function uiAutoLoadMessages(){if(howManyMessages=$(".js-list-chat li.js-chat-message").size(),lastMessageToScroll=$(".js-list-chat li.js-chat-message").first(),howManyMessages>0&&howManyMessages>=limitMessages&&isScrolledIntoView(olderMessagesLoader)){NProgress.inc();olderMessagesLoader.addClass("js-loader-open");timeoutUiAutoLoadMessages=setTimeout(function(){if(howManyMessages>=limitMessages){var n=firebaseService.getOlder();messageListContainer.find(".stick").removeClass("stick");$.when(n).done(function(){olderMessagesLoader.removeClass("js-loader-open");scrollToFirstMessage();timeoutUiAutoLoadMessages=!1;NProgress.done()})}else olderMessagesLoader.removeClass("js-loader-open"),scrollToFirstMessage(),timeoutUiAutoLoadMessages=!1,NProgress.done()},800)}}function loadSearchContact(){inputFinder2.autocomplete("option",{source:cloud.searchContacts})}function responsiveUI(){var n;$(".js-open-wz-column").click(function(t){t.preventDefault();n=$(this).attr("href");$(n).addClass("js-open-col");$(".js-close-wz-column").click(function(t){t.preventDefault();n=$(this).attr("href");$(n).removeClass("js-open-col")})})}function roninDrag(){initSortableCards();initSortableToolbar()}function initSortableToolbar(){Sortable.create(roninToolBar,{group:{name:"roninToolBar",pull:"clone"},sort:!1,animation:100})}function initSortableCards(){roninCards=$("#roninCards ul");numberUlCards=1;roninCards.each(function(){arrayCards.push($(this).attr("id"));numberUlCards+=1});arrayCards.push("roninToolBar");roninCards.each(function(n,t){z=n;id=$(this).attr("id");idString=id.toString();idSharp="#"+idString;sortab=!0;disable=!1;$(this).hasClass("bool-li")?(sortab=!1,disabl=!0):(sortab=!0,disabl=!1);Sortable.create(t,{group:{name:idString,put:arrayCards},sort:sortab,disabled:disabl,draggable:".item",filter:".ignore",animation:100,onMove:function(n){groupposition2=n.dragged.dataset.groupPosition;colnumber2=n.related.dataset.colNumber;groupdepth2=n.related.dataset.groupDepth;n.dragged.dataset.groupPosition=groupposition2;n.dragged.dataset.colNumber=colnumber2;n.dragged.dataset.groupDepth=groupdepth2},onEnd:function(n){var t=$("#"+n.to.id);t.children("li").each(function(n){$(this).attr("data-item-position",n.toString())})},onAdd:function(n){par=n;par2=z;onAddFunction(par,par2)}})})}function onAddFunction(n,t){var u=$("#roninCards ul").length,i,r;if(u+=2,theItem=n.item,theItem.className="",theItem.classList.add("sort-"+n.newIndex+"-"+t),gDepth=n.to.dataset.groupdepth,$("ul[data-groupdepth='"+gDepth+"']").find("li").each(function(){$(this).attr("data-group-depth",gDepth);$(this).attr("data-group-position",$(this).parent().attr("data-position"))}),theItem.dataset.itemPosition=n.newIndex,counter=-1,$("li[data-group-depth='"+gDepth+"']").each(function(){"0"===$(this).attr("data-item-position")&&counter++;$(this).attr("data-col-number",counter)}),icon=$(".sort-"+n.newIndex+"-"+t).children("i").attr("class"),dataType=n.item.attributes[0].nodeValue,ulId=$("#"+n.to.id),"conditional"==dataType){if(groupDepth=ulId.attr("data-groupdepth"),groupDepth=parseInt(groupDepth),groupDepth+=1,groupDepth>4)return new NotificationPlugin(trAddAnother,trIsNotPossible,"icon-lock"),void n.to.removeChild(n.item);theItem.classList.add("ignore");$(ulId).removeClass("dropzone");number01=numberUlCards+1;number02=numberUlCards+2;i=parseInt(ulId.attr("data-position"));ulId.after('<ul id="n'+n.to.id+'" class="bool bool-li" data-position="'+(i+1)+'" data-groupdepth="'+(groupDepth-1)+'"><\/ul>');ulId.next().append(n.item);ulId.next().after('<div class="row row-bool"><span class="bool-border"><\/span><div class="col-xs-6"><ul id="cards'+number01+'" class="bool bool-yes dropzone" data-position="'+(i+2)+'" data-groupdepth="'+groupDepth+'"><\/ul><\/div><div class="col-xs-6"><ul id="cards'+number02+'" class="bool bool-no dropzone" data-position="'+(i+2)+'" data-groupdepth="'+groupDepth+'"><\/ul><\/div><\/div>');initSortableCards()}else"options"==dataType?(groupDepth=ulId.attr("data-groupdepth"),groupDepth=parseInt(groupDepth),groupDepth+=1,theItem.classList.add("ignore"),$(ulId).removeClass("dropzone"),number01=numberUlCards+1,number02=numberUlCards+2,i=parseInt(ulId.attr("data-position")),ulId.after('<ul id="n'+n.to.id+'" class="bool bool-li" data-position="'+(i+1)+'" data-groupdepth="'+(groupDepth-1)+'"><\/ul>'),ulId.next().append(n.item),r='<li data-type="option-answered" draggable="false" data-group-depth="'+groupDepth+'" data-group-position="'+(i+2)+'" data-item-position="0" data-col-number="1" data-question="Un caf\u00e9 con leche" data-error="" data-check="false" data-selectfield="Otros" class="user-answer"><i class="icon-head"><\/i><i class="icon-check"><\/i><span class="text">Un caf\u00e9 con leche<\/span><div class="btn btn-info r-edit" onclick="editCard(this);"><span class="text">'+trEdit+'<\/span><i class="icon-pencil"><\/i><\/div><\/li>',ulId.next().after('<div class="row row-bool"><div class="col-xs-12"><ul id="cards'+number01+'" class="bool ul-options dropzone" data-position="'+(i+2)+'" data-groupdepth="'+groupDepth+'">'+r+'<\/ul><\/div><div class="col-xs-12"><ul id="cards'+number02+'" class="bool ul-options dropzone" data-position="'+(i+2)+'" data-groupdepth="'+groupDepth+'">'+r+"<\/ul><\/div><\/div>"),initSortableCards()):theItem.classList.add("item");classItem=".sort-"+n.newIndex+"-"+t;theItem.dataset.question||createModal(classItem,dataType,icon)}function createModal(n,t,i,r,u,f,e){function s(){$(".card-check").prop("checked")?$(".js-check").show():$(".js-check").hide()}label='<label for="id_short_description" class="control-label col-sm-3">'+trQuestion+"<\/label>";input='<div class="col-sm-9"><input class="form-control card-question" type="text"><\/div>';label2='<label for="id_short_description" class="control-label col-sm-3">'+trErrorText+"<\/label>";input2='<div class="col-sm-9"><input class="form-control card-error" type="text"><\/div>';var o="";"__none__"===t&&(o="hidden");inputCheck='<label class="control-label col-sm-3 '+o+'"><input class="card-check" name="featured" type="checkbox"> '+trDoYouWant+"<\/label>";select='<label class="control-label col-sm-3 js-check '+o+'">'+trChooseTheUser+'<\/label><div class="col-sm-9"><select class="form-control select-field js-check"><option>name<\/option><option>email<\/option><option>phone<\/option><option>birthdate<\/option><option>postal_code<\/option><option>address<\/option><option>city<\/option><option>country<\/option><\/select><\/div>';formGOpen='<div class="form-group">';formGClose="<\/div>";formOpen='<form id="edit-question-form" role="form" class="form-horizontal">';formClose="<\/form>";content=formOpen+formGOpen+label+input+formGClose;"__none__"!==t&&(content+=formGOpen+label2+input2+formGClose);content+=formGOpen+inputCheck+formGClose+formGOpen+select+formGClose+formClose;backgroundDisabled=$('<div class="wz-bg-disabled-ronin"><\/div>');customModal=$('<div class="modal fade wz-modal-sideleft '+t+'" id="myModal" role="dialog" aria-labelledby="myModalLabel" data-keyboard="false"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" id="myModalLabel">'+trEditQuestion+'<\/h4><\/div><div class="modal-body">'+content+'<\/div><div class="modal-footer"><button type="button" class="btn btn-default btn-close" data-dismiss="modal">'+trRemoveItem+'<\/button><button type="button" class="btn btn-primary save-button">'+trSaveChanges+"<\/button><\/div><\/div><\/div><\/div>");$("body").append(backgroundDisabled);$("body").append(customModal);customModal.on("hidden.bs.modal",function(){$(".wz-bg-disabled-ronin").remove();$("#myModal").remove()});r&&$(".card-question").val(r);u&&$(".card-error").val(u);"true"===f?$(".card-check").prop("checked",!0):$(".card-check").prop("checked",!1);e&&$(".select-field").val(e);$("#edit-question-form").submit(function(n){n.preventDefault()});$("#myModal").modal();$("#myModal").modal("show");targetDiv=$(n);s();$(".card-check").click(function(){s()});$(".save-button").click(function(){cQuestion=$(".card-question").val();cError=$(".card-error").val();cCheck=$(".card-check").prop("checked")?"true":"false";sField=$(".select-field").val();cQuestion.length&&(targetDiv.html('<i class="'+i+'"><\/i><span class="text">'+cQuestion+'<\/span><div class="btn btn-info r-edit" onclick="editCard(this);"><span class="text">'+trEdit+'<\/span><i class="icon-pencil"><\/i><\/div>'),targetDiv.attr("data-question",cQuestion).attr("data-error",cError).attr("data-check",cCheck).attr("data-selectField",sField),$("#myModal").modal("hide"),$("#myModal").remove(),$(".wz-bg-disabled-ronin").remove())});$(".btn-close").click(function(){parentDiv=targetDiv.parent();targetDiv.hasClass("ignore")&&(parentDiv.next().remove(),parentDiv.prev().addClass("dropzone"),parentDiv.remove());targetDiv.remove();$("#roninCards .label").remove();0===parentDiv.children().length&&parentDiv.addClass("dropzone");$("#myModal").remove();$(".wz-bg-disabled-ronin").remove()})}function editCard(n){element=n;rClass=$(element).parent().attr("class");rClass=rClass.replace("item","").replace(" ","").replace("ignore","");rData=$(element).parent().attr("data-type");rQuestion=$(element).parent().attr("data-question");rError=$(element).parent().attr("data-error");rIcon=$(element).parent().children("i").attr("class");rField=$(element).parent().attr("data-selectField");rCheck=$(element).parent().attr("data-check");createModal("."+rClass,rData,rIcon,rQuestion,rError,rCheck,rField)}function saveJson(){var c=$(".js-nameRonin").val(),l=$("#wz-modal-ronin").attr("data-mode"),e=[],i,r,u,s,f,h;$(".js-select-channels.checked").each(function(){e.push($(this).attr("data-channel"))});var o,n=[],t=[],a=[];modeId=$(this).attr("data-id");t={id:modeId,setup:{name:c,mode:l,channel:e},group:{type:"regular",cards:[]}};$("#roninCards > .row > .col-xs-12 > ul").each(function(n,e){$(e).children("li").each(function(n,e){i=$(e).attr("data-question");r=$(e).attr("data-error");u=$(e).attr("data-check");s=$(e).attr("data-selectField");f=$(e).attr("data-type");var o;o="true"==u?{type:f,question:i,error:r,check:u,selectField:s,group:" "}:{type:f,question:i,error:r,group:" "};t.group.cards[n]=o});$(e).next(".row-bool").children(".col-xs-6").children("ul").length>0&&$(e).next(".row-bool").children(".col-xs-6").children("ul").each(function(){o={type:"boolhijo"};a.push(o)})});n.push(t);console.log(t);h=cloud.saveRoninMode(JSON.stringify(n));$.when(h).done(function(){roninModal.modal("hide");var t=n[0].id?"edit":"add";"register"==n[0].setup.mode?mixpanelEvents(t+"RegisterBot"):"on busy"==n[0].setup.mode&&mixpanelEvents(t+"AutoresponseBot")})}function roninSetup(n){switch(n){case"register":$("#wz-modal-ronin").modal("show")}}function roninLoad(){}function saveRoninJson(){var n=cloud.saveRoninMode(JSON.stringify({}));$.when(n).done(function(){roninModal.modal("hide")})}function enableRonin(n){switch(n){case"register":$(".wz-ronin-0 .wz-ronin-switch").buttonswitch("setStatus",1)}}function disableRonin(n){switch(n){case"register":$(".wz-ronin-0 .wz-ronin-switch").buttonswitch("setStatus",0)}}function setBotsContactStep(n,t){"1"==n?(botDescription2A.val(""),botDescription2B.val(""),$("#wz-modal-bots-contact .js-next-step").addClass("disabled")):"3"==n&&$("#wz-modal-bots-contact .js-prev-step").data("step",t);$('#wz-modal-bots-contact [class^="js-bots-contact-"]').addClass("hide");$("#wz-modal-bots-contact .js-bots-contact-"+n).removeClass("hide")}function moveRoninModalToStep(n){$("#wz-modal-ronin .wz-step").removeClass("js-active").removeClass("js-prev").removeClass("js-next");var t=$(n);t.addClass("js-active");t.next().length>0&&t.next().addClass("js-next");t.prev().length>0&&t.prev().addClass("js-prev")}function roninEdit(n){$.each(n.channels,function(n,t){var i=$(".js-select-channels").filter(function(){return $(this).data("channel")==t});i.addClass("checked")});jsonEdited=n;moveRoninModalToStep("#wz-modal-ronin .wz-step-sortable");roninHtmlEdit(jsonEdited);$(".js-nameRonin").val(n.name);$(".save-json").attr("data-id",jsonEdited.id);roninDrag();var t=$(".js-select-mode").filter(function(){var t="on busy"==n.mode?"autorresponse":"register";return $(this).data("mode")==t}),i=t.attr("data-mode");$("#wz-modal-ronin").attr("data-mode",i);$("#wz-modal-ronin").modal("show")}function roninAdd(n){var t={0:{setup:{name:"",mode:n,channel:""},group:{type:"regular",cards:{}}}};g=1;$(".js-select-channels.checked").removeClass("checked");moveRoninModalToStep("#wz-modal-ronin .wz-step:first-child");$(".js-nameRonin").val("");roninHtml(t);$(".save-json").removeAttr("data-id");roninDrag();$("#wz-modal-ronin").modal("show")}function returnUlLi(n){idUl="cards"+g;idLi="sort-"+g;ulOpen='<ul class="'+ulClasses+'" id="'+idUl+'">';ulClose="<\/ul>";li='<li class="'+liClasses+" "+idLi+'" data-item-position="'+g+'" data-question="'+dataQuestion+'" data-error="'+dataError+'" data-check="'+dataCheck+'" data-selectfield="'+dataSelectField+'" data-type="'+n+'"><i class="icon-align-left"><\/i><span class="text">'+dataQuestion+'<\/span><div class="btn btn-info r-edit" onclick="editCard(this);"><span class="text">Edit<\/span><i class="icon-pencil"><\/i><\/div><\/li>'}function eachNested(n,t){liClasses="item";for(var i in n)n[i].group!==!1?(dataQuestion=n[i].question,dataError=n[i].error,dataCheck=n[i].check,dataSelectField=n[i].selectField,dataType=n[i].type,ulClasses="dropzone",hasGroup=!0,returnUlLi(),htmlRonin+=ulClose,ulClasses="bool bool-li",liClasses="ignore",g++,returnUlLi(),htmlRonin+=ulOpen+li+ulClose+columnConditionalOpen,g++,ulClasses="bool bool-yes",Object.keys(n).length>itemCounter&&(ulClasses="bool bool-yes dropzone"),returnUlLi(),htmlRonin+=colxs6Open+ulOpen,eachNested(n[i].group.yes.cards,!0),ulClasses="bool bool-no",Object.keys(n).length>itemCounter&&(ulClasses="bool bool-no dropzone"),itemCounter++,returnUlLi(),htmlRonin+=ulClose+colxs6Close+colxs6Open+ulOpen,eachNested(n[i].group.no.cards,!0),htmlRonin+=ulClose+colxs6Close+columnConditionalClose):(dataQuestion=n[i].question,dataError=n[i].error,dataCheck=n[i].check,dataSelectField=n[i].selectField,dataType=n[i].type,1==itemCounter||t===!0?(liClasses="item",g++,returnUlLi(),htmlRonin+=li):(ulClasses=" ",Object.keys(n).length>itemCounter&&(ulClasses="dropzone next-dropzone"),returnUlLi(),htmlRonin+=ulOpen,liClasses="item",g++,returnUlLi(),htmlRonin+=li+ulClose))}function roninHtml(n){$("#wz-modal-ronin").attr("data-mode",n[0].setup.mode);$(".js-select-channels").each(function(){channelInJson=$(this).attr("data-channel");$.inArray(channelInJson,n[0].setup.channel)>-1&&$(this).trigger("click")});ulClasses="dropzone";Object.keys(n[0].group.cards).length>1&&(ulClasses=" ");returnUlLi();htmlRonin=firstColumnOpen+ulOpen;hasGroup=!1;eachNested(n[0].group.cards,!1);htmlRonin+=hasGroup===!1?ulClose+firstColumnClose:firstColumnClose;$("#roninCards").html(htmlRonin)}function roninHtmlEdit(n){modeId=n.id;$("#wz-modal-ronin").attr("data-mode",n.mode);$(".js-select-channels").each(function(){channelInJson=$(this).attr("data-channel");$.inArray(channelInJson,n.channel)>-1&&$(this).trigger("click")});ulClasses="dropzone";Object.keys(n.status).length>1&&(ulClasses=" ");returnUlLi();htmlRonin=firstColumnOpen+ulOpen;eachNestedEdit(n.status,!1);htmlRonin+=ulClose+firstColumnClose;$("#roninCards").html(htmlRonin)}function eachNestedEdit(n,t){liClasses="item";for(var i in n)dataQuestion=n[i].questions[0].text,dataError=n[i].errors[0]?n[i].errors[0].text:"",dataSelectField=n[i].selectField,dataType=n[i].type,dataCheck=null==dataSelectField?!1:!0,1==itemCounter||t===!0?(liClasses="item",g++,returnUlLi(dataType),htmlRonin+=li):(ulClasses=" ",Object.keys(n).length>itemCounter&&(ulClasses="dropzone next-dropzone"),returnUlLi(dataType),htmlRonin+=ulOpen,liClasses="item",g++,returnUlLi(dataType),htmlRonin+=li+ulClose)}function initRoninUI(){roninUI()}function roninUI(){var i,n,t,r,u;selectChannels();selectLanguage();selectFields();tooltips("#wz-modal-ronin");$(".js-select-mode").click(function(){modeAttr=$(this).attr("data-mode");$("#wz-modal-ronin").attr("data-mode",modeAttr)});$(".wz-step").each(function(){$(this).find("form").submit(function(n){n.preventDefault()});$(this).find(".nav-btn").children(".next").click(function(){var u=$(this).data("validate"),f;if(u){if($(u).removeClass("error"),f=$.trim($(u).val()),0==f.length)return setTimeout(function(){$(u).addClass("error");$(u).focus()},50),!1;$(u).val(f)}i=$(".js-active");t=$(".js-prev");n=$(".js-next");r=n.next();n.length>0&&(i.removeClass("js-active").addClass("js-prev"),t.removeClass("js-prev"),n.removeClass("js-next").addClass("js-active"),r.addClass("js-next"));r.length<1&&console.log("end");t.length<1&&(i.removeClass("js-active").addClass("js-prev"),n.removeClass("js-next").addClass("js-active"),r.addClass("js-next"))});$(this).children(".nav-btn").children(".prev").click(function(){i=$(".js-active");t=$(".js-prev");n=$(".js-next");u=t.prev();t.length>0&&(i.removeClass("js-active").addClass("js-next"),t.removeClass("js-prev").addClass("js-active"),n.removeClass("js-next"),u.addClass("js-prev"));u.length<1&&console.log("init");n.length<1&&(i.removeClass("js-active").addClass("js-next"),t.removeClass("js-prev").addClass("js-active"),u.addClass("js-prev"))})})}function roninDelete(n,t){var i=cloud.roninDelete(n);$.when(i).done(function(){cloud.loadRoninModal();0==t?mixpanelEvents("deleteAutoresponseBot"):1==t&&mixpanelEvents("deleteRegisterBot")})}function roninDisable(n,t){var i=cloud.roninDisable(n);$.when(i).done(function(){cloud.loadRoninModal();0==t?mixpanelEvents("disableAutoresponseBot"):1==t&&mixpanelEvents("disableRegisterBot")})}function selectChannels(){$(".js-select-channels").click(function(n){n.preventDefault();$(this).toggleClass("checked")})}function selectLanguage(){$(".js-select-languages").click(function(n){n.preventDefault();$(this).parent().find(".js-select-languages").removeClass("checked");$(this).toggleClass("checked")})}function selectFields(){$(".js-select-fields").click(function(n){n.preventDefault();"others"!==$(this).data("field")&&$(this).toggleClass("checked")})}function sendTemplate(n){inputAudio.val("");inputImage.val("");inputImageFlags.val("");inputImageUrls.val("");inputMessageTag.val("");inputModalMessageTag.val(n);for(var t=0;6>t;t++)imgSendUrls[t]="";$("#js-gallery-error-upload").addClass("hide");$(".js-submit-image").prop("disabled",!1);modalImg.modal("show")}function sendMessages(){buttonSendimageA.on("click",function(n){n.preventDefault()});buttonSendimage.on("click",function(){inputAudio.val("");inputImage.val("");inputImageFlags.val("");inputImageUrls.val("");inputMessageTag.val("");inputModalMessageTag.val("");for(var n=0;6>n;n++)imgSendUrls[n]="";$("#js-gallery-error-upload").addClass("hide");$(".js-submit-image").prop("disabled",!1);modalImg.modal("show")});buttonSendaudio.on("click",function(){inputAudio.click()});submitImg.click(function(){sendImageForm()});modalFormImageUpload.on("submit",function(n){n.preventDefault();sendImageForm()});checkNote.on("click",function(){$(this).hasClass("js-checked")?(txt.attr("placeholder",trWriteNote),$("#send_form").addClass("js-note"),mixpanelEvents("privateNoteClick")):(txt.attr("placeholder",trTypeMessage),$("#send_form").removeClass("js-note"));txt.focus()});sendForm.on("submit",function(n){n.preventDefault();firstMessageToScroll=!1;var t=$.trim(txt.val()),i=t.length+$.trim(inputImageFlags.val()).length;return 0==i?!1:(checkNote.hasClass("js-checked")?sendInnerNote(this):sendMessage(this),void txt.val(""))})}function sendMessage(n){if("object"==typeof CONTACTS[currentChat])if(CONTACTS[currentChat].getAgent()){if(CONTACTS[currentChat].getAgent()!=myID)return void introJsAssignate()}else CONTACTS[currentChat].assignMe();var t=showGhostChat(AGENTS[myID].avatar||"",AGENTS[myID].name.capitalizeFirstLetter());cloud.sendForm(n,cloud.getURLs().messages.send,function(n){var t,i;n.ok?(THREADS[CONTACTS[currentChat].getKey()].setReplied(!0),mixpanelEvents("messageSent",CONTACTS[currentChat].getChannelType().toLowerCase()),t=$(".js-status-select.selected"),t.size()>0&&(i=t.data("status"),"0"==i&&cloud.setStatus(1).done(function(){mixpanelEvents("changeTicketStatusAuto",1)}))):n.list&&n.list.customer&&n.list.customer.forEach(function(n){new NotificationPlugin("error",n,"icon-lock",null,null,2e3)})}).fail(function(){t&&t.find(".js-chat-ghost-action").fadeIn()});inputAudio.val("");inputImage.val("");inputImageFlags.val("");inputImageUrls.val("");inputMessageTag.val("")}function sendInnerNote(n){txt.val().length>0&&(cloud.sendForm(n,cloud.getURLs().customers.inner_note,function(n){n.ok?mixpanelEvents("privateNoteSent",CONTACTS[currentChat].getChannelType().toLowerCase()):new NotificationPlugin(trError,trErrorSendingNote,"icon-lock",null,null,2e3)}),checkNote.click())}function settingsUI(n){var t="#wz-modal-clients "+(n||"");$(t+" .js-show-edit").click(function(){var n=$(this).attr("data-target"),t=$(this).attr("data-targethide");$(n).removeClass("hide");$(t).addClass("hide")});$(t+" .dropdown").on("hide.bs.dropdown",function(){"none"!=$(this).find(".wz-sub-dropdown").css("display")&&($(this).parent().find(".wz-sub-dropdown").hide(),$(this).find(".js-delete span:first-child").removeClass("hide"),$(this).find(".js-delete span:last-child").addClass("hide"))});$(t+" .js-delete").on("click",function(n){n.stopPropagation();$(this).parent().find(".wz-sub-dropdown").fadeToggle();$(this).find("span").toggleClass("hide")});$(t+" .js-delete-cancel").on("click",function(n){n.stopPropagation();$(this).parent().parent().parent().find(".js-delete").click()});$(t+" .js-custom-checkbox").checkbox();$(t+" .js-custom-file").each(function(){var n=$(this).find('input[type="text"]'),t=$(this).find('input[type="file"]'),i=$(this).find(".btn.js-upload"),r=$(this).find(".btn.js-browse"),u=function(n){t.click();n.stopPropagation()},f=function(){var t=$(this)[0].files[0];t?(i.removeClass("hide"),n.val(t.name)):(i.addClass("hide"),n.val(""))};n.size()>0&&t.size()>0&&(r.unbind("click"),n.unbind("click"),t.unbind("change"),r.bind("click",u),n.bind("click",u),t.bind("change",f),n.prop("readonly",!0).prop("placeholder",trNoFileSelected))});$(t+" .js-hide-edit").click(function(){var n=$(this).attr("data-target");$(n).addClass("hide");$(targethide).addClass("hide")});settingsUIRedirect&&($("#wz-modal-clients .wz-crm-menu li a[href="+settingsUIRedirect+"]").click(),settingsUIRedirect=!1)}function loadShortcuts(n){shortcuts(n);setShortcuts(txt,sendForm);loadShortcutsButtons(n);printTable(n)}function printTable(n){$("#shortcuts-table").tabulator({columns:[{title:trShortcut,field:"shortcut",sortable:!0},{title:trText,field:"name",sortable:!0}],rowClick:function(n,t){cloud.getShortcutForm(t+"/")},fitColumns:!0,showLoader:!1,sortable:!0,renderComplete:function(){$("#shortcuts-table").fadeIn(100)},height:"calc(100vh - 195px)",data:n});$("#shortcuts-table").tabulator("setData",n);$("#shortcuts-table").tabulator("redraw")}function filter(n,t){t=$.trim(t);t=t.replace(/ /gi,"|");$(n).each(function(){$(this).text().search(new RegExp(t,"i"))<0?$(this).hide().removeClass("visible"):$(this).show().addClass("visible")})}function tooltips(n){var t=n||"";$(t+' [data-toggle="tooltip"]').tooltip()}function newVersionTutorial(){"undefined"!=typeof Storage?1!=localStorage.hibazaNewVersionTutorial&&(localStorage.hibazaNewVersionTutorial=1,modalNotification({icon:"icon-new-interface",title:trWelcome,message:trWeHaveAdded,buttons:[{"class":"btn-pink",text:trShowMeHow,callback:function(){$notificationModal.modal("hide");introJsNewInterface()}}]})):console.log(" No Web Storage support.")}function newTextareaTutorial(){"undefined"!=typeof Storage?1!=localStorage.hibazaNewVersionTextarea&&(localStorage.hibazaNewVersionTextarea=1,introJsNewTextarea()):console.log(" No Web Storage support.")}function newTicketTutorial(n){if("undefined"!=typeof Storage){if("false"!=localStorage.hibazaNewVersionTickets&&1==localStorage.hibazaNewVersionTutorial&&!$notificationModal.hasClass("in")){if(localStorage.hibazaNewVersionTickets){var t=localStorage.hibazaNewVersionTickets.split(",");-1==t.indexOf(n)&&(localStorage.hibazaNewVersionTickets+=","+n)}else localStorage.hibazaNewVersionTickets=n;t=localStorage.hibazaNewVersionTickets.split(",");t.length==newTicketTutorialGoal&&(localStorage.hibazaNewVersionTickets="false",modalNotification({icon:"icon-new-interface",message:trTicketsSimple,buttons:[{"class":"btn-pink",text:trLearn,callback:function(){$notificationModal.modal("hide");introJsNewTickets()}}]}))}}else console.log(" No Web Storage support.")}function newTicketViewTutorial(){"undefined"!=typeof Storage?"false"==localStorage.hibazaNewVersionTickets&&1!=localStorage.hibazaNewVersionTicketsView&&"ticket"==viewProfile&&(localStorage.hibazaNewVersionTicketsView=1,introJsNewTicketView()):console.log(" No Web Storage support.")}function addHow(){$(".wz-welcome-new .js-added .added .btn-pink").click(function(){$(".wz-welcome-new .js-added").addClass("js-how")});$(".wz-how .btn-pink").click(function(){$(".wz-welcome-new .js-added").removeClass("js-how")})}function showLink(n){var i=n.data.shareValue,t=(n.data.valueType,$(this).data("channel-type"));$("#wz-modal-welcome .js-share-"+t).addClass("hide");$("#wz-modal-welcome .js-share-"+t+"-copied span").text(i);$("#wz-modal-welcome .js-share-"+t+"-copied").removeClass("hide").trigger("click")}function disableTutorial(){console.log("disable");tutorialActive=!1;welcomeModal.modal("hide")}function toggleBotScreens(){var n,t=$("#wz-modal-bot-edit-block,#wz-modal-bot-edit-tree");$(".js-s-block-tree a").click(function(i){i.preventDefault();$(".js-s-block-tree a").toggleClass("wz-switch-active");$(".js-s-block-tree a").toggleClass("wz-switch-inactive");n=$(this).attr("href");t.hide();$(n).show()})}function addOptions(){var n='<div class="wz-edit-footer"><div class="btn btn-pink btn-goto">Go to...<\/div><div class="wz-icons"><a href=""><i class="icon-align-left"><\/i><\/a><a href=""><i class="icon-image"><\/i><\/a><a href=""><\/a><div class="dropdown"><a href="#" data-toggle="dropdown"><span>ADD VARIABLE {}<\/span><\/a><ul class="dropdown-menu dropdown-variables"><li><a href="#" class="js-add-variable" data-variable="customer.firstName"><span class="wz-font-s-md wz-font-w-med">First Name<i class="pull-right icon-arrow-right"><\/i><\/span><\/a><\/li><li><a href="#" class="js-add-variable" data-variable="customer.firstName"><span class="wz-font-s-md wz-font-w-med">Last Name<i class="pull-right icon-arrow-right"><\/i><\/span><\/a><\/li><\/ul><\/div><\/div><\/div>';$(".js-add-option").click(function(){$(this).parent().before('<li class="js-options"><p id="focused" contenteditable="true" placeholder="Write your text"><\/p><i class="icon-trash pull-right"><\/i>'+n+"<\/li>");document.getElementById("focused").focus();$("#focused").removeAttr("id");removeOptions();gotoOptions();insertVariables()});removeOptions();gotoOptions();insertVariables()}function removeOptions(){$(".wz-message-list i").click(function(){$(this).parent().remove()})}function gotoOptions(){$(".btn-goto").click(function(){goToBlock("options",this)});$(".dropdown-goto li a").click(function(){var i=$(this).html(),n,t;$(this).parent().parent().prev().html(i);n=$(this).children("span").html();t=n.slice(7,-61);$(this).parent().parent().parent().parent().prev().prev().attr("data-next",t)})}function goToBlock(n,t){if($(t).parent(".dropdown-goto").length<1){$(t).wrap("<div class='dropdown dropdown-goto'><\/div>");$(t).attr("data-toggle","dropdown");$(t).after('<ul class="dropdown-menu"><\/ul>');var i="";$(".wz-bot-block").each(function(r,u){"options"!=n&&(i='onclick="renderBlock7('+$(u).children(".wz-block-number").html()+')"');$(t).next().append('<li><a href="#" '+i+'><span class="wz-font-s-md.wz-font-w-med">'+$(u).children(".wz-block-text").html()+'<i class="pull-right icon-arrow-right><\/i>"<\/span><\/a><\/li>')});$(t).dropdown();$(".dropdown-goto").dropdown("toggle")}gotoOptions()}function replaceTemplateTag(n){var t=$(n).text().replace(/\[\[/g,"{{").replace(/\]\]/g,"}}");$(n).text(t)}function editMessageText(n,t){"back"==t?$(n).children().children(".wz-message-text.blocked").click(function(){$(this).parent().parent().nextAll("li").remove();$(this).parent().parent().remove();renderBlock3()}):$(".wz-message-text.blocked").click(function(){var t=$(this).children("p").html(),i={id:"1",text:t,callback:"renderBlock2",side:"left"};replaceTemplateTag(".js-block-message-edit");content=blockMessageEdit.tmpl(i);$(this).parent().parent().replaceWith(content);document.getElementById("focused1").focus();$(n).children().children(".wz-message-text.blocked")})}function renderMessageModel(n,t,i,r){var u;i&&$(i).hide();"edit"==n&&(replaceTemplateTag(".js-block-message-edit"),u=blockMessageEdit.tmpl(t),$(".wz-edit-block-messages").append(u),document.getElementById("focused1").focus());"text"==n&&(replaceTemplateTag(".js-block-message-text"),u=blockMessageText.tmpl(t),$(".wz-edit-block-messages").append(u));"question"==n&&(replaceTemplateTag(".js-block-message-question"),u=blockMessageQuestion.tmpl(t),$(".wz-edit-block-messages").append(u));"list"==n&&(replaceTemplateTag(".js-block-message-list"),u=blockMessageList.tmpl(t),$(".wz-edit-block-messages").append(u),addOptions());"next"==n&&(replaceTemplateTag(".js-block-message-next"),u=blockMessageNext.tmpl(t),$(".wz-edit-block-messages").append(u));r&&r()}function insertVariables(){$(".wz-message-edit .js-add-variable").click(function(){var n=$(this).attr("data-variable");n='{<span class="wz-font-c-pink">'+n+"<\/span>} ";$(this).parent().parent().parent().parent().parent().prev().append(n)});$(".wz-message-list .js-add-variable").click(function(){var n=$(this).attr("data-variable");n='{<span class="wz-font-c-pink">'+n+"<\/span>} ";$(this).parent().parent().parent().parent().parent().prev().prev().append(n)})}function newBlock(){$(".wz-edit-block-messages").html(" ");renderBlock1();$(".wz-bot-block.active").removeClass("active");var n=$(".wz-bot-block:last");blockNumber=parseInt(n.children("i").html())+1;$("#wz-modal-bot-edit-block h3").html("Block #"+blockNumber);n.after('<li class="wz-bot-block active" id="bot-block-'+blockNumber+'"><i class="wz-block-number">'+blockNumber+'<\/i><span class="wz-block-text">Block #'+blockNumber+'<\/span><span class="wz-block-actions"><i class="icon-trash"><\/i><i class="icon-move"><\/i><\/span><\/li>')}function createObject(){newObject={};$("#bot-block-"+blockNumber).attr("data-object","blockObj"+blockNumber);currentRoninStatus=roninMode.addStatus(blockNumber)}function renderBlock1(){renderMessageModel("edit",{id:"1",text:"",callback:"renderBlock2",side:"left"});setTimeout(createObject,2e3);setTimeout(insertVariables,2e3)}function renderBlock2(n){var t={id:"2",text:n,side:"left",blocked:"true"};renderMessageModel("text",t,"#message-1",renderBlock3);editMessageText();newObject.questionType="text";newObject.question=n;currentRoninStatus.addResponse(n);console.log(newObject)}function renderBlock3(){renderMessageModel("question",{id:"3",question:"Choose a type of response for your message.",buttons:{"Give information":"renderBlock4","Choose an option":"renderBlock8",Nothing:"renderBlock6"},side:"right"})}function renderBlock4(){renderMessageModel("question",{id:"4",question:"Which type of data do you want in the answer?",buttons:{Name:"renderBlock5",Phone:"renderBlock5",Email:"renderBlock5",Zip:"renderBlock5",Address:"renderBlock5",Country:"renderBlock5",Birthdate:"renderBlock5",Other:"renderBlock5"},side:"right"},"#message-3");newObject.answerType="give information"}function renderBlock5(n){var t={id:"5",text:'My <span class="wz-font-u-lowercase">'+n+'<\/span> is <span class="wz-font-c-pink wz-font-u-lowercase">{{'+n+"}}<\/span>...",side:"right",blocked:"true"};currentRoninStatus.setField(n);renderMessageModel("text",t,"#message-4",renderBlock6);editMessageText("#message-5","back");newObject.dataAnswered=n}function renderBlock6(n){var t={id:"6",question:"Choose what happens next.",buttons:{"Go to next block":"renderBlock7","Go to certain block":"goToBlock","Stop conversation":"renderBlock7"},side:"left"};"Nothing"==n?(renderMessageModel("question",t,"#message-3"),currentRoninStatus.setProcesser("__none__"),newObject.answerType="nothing",console.log(newObject)):renderMessageModel("question",t)}function renderBlock7(n){var t=blockNumber+1,i;n&&"Go to next block"!=n&&(t=n);"Stop conversation"==n&&(t=0);i={id:"7",text:t};renderMessageModel("next",i,"#message-6");"Stop conversation"==n&&$("#message-7 p.tmpl-message").html('<i class="icon-lock" style="margin-right:10px;"><\/i>Stop conversation.');newObject.nextAction="goToBlock";newObject.nextBlock=t;0!=t&&roninMode.addRelation(currentRoninStatus.id,t);"blockObj"+blockNumber;window["blockObj"+blockNumber]=newObject;console.log(newObject)}function renderBlock8(){renderMessageModel("list",{id:"8",options:{},side:"right",callback:"renderBlock9"},"#message-3");$(".js-add-option").trigger("click");currentRoninStatus.setProcesser("__choice__");newObject.answerType="choose an option";console.log(newObject)}function renderBlock9(){renderMessageModel("next",{id:"9",text:"0"});$(".wz-message-next .tmpl-message").remove();$(".js-advanced").addClass("top");$("#message-8 .wz-message-list").addClass("blocked");$(".js-options").each(function(n,t){var i="option"+n,r=$(t).children("p").html(),u=$(t).children("p").attr("data-next");optionsObject[i]={};optionsObject[i].id=n;optionsObject[i].type="text";optionsObject[i].option=r;optionsObject[i].nextAction="goToBlock";optionsObject[i].nextBlock=u});newObject.options=optionsObject;"blockObj"+blockNumber;window["blockObj"+blockNumber]=newObject;console.log(newObject)}function clickLoadBlock(){$(".wz-bot-block").click(function(){var n=$(this).attr("id");n="#"+n;loadBlock(n)})}function loadBlock(n){if($(n).length<1)newBlock(),clickLoadBlock();else if($(".wz-bot-block.active").removeClass("active"),$(n).addClass("active"),blockNumber=parseInt($(n).children("i").html()),$("#wz-modal-bot-edit-block h3").html("Block #"+blockNumber),$(".wz-edit-block-messages").html(" "),window[$(n).attr("data-object")]){var t=window[$(n).attr("data-object")];loadBlocks(t)}else renderBlock1()}var deleteDictKey,addDictKey;jQuery.expr[":"].Contains=jQuery.expr.createPseudo(function(n){return function(t){return jQuery(t).text().toUpperCase().indexOf(n.toUpperCase())>=0}});String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)};deleteDictKey=function(n,t){"undefined"!=typeof n&&"undefined"!=typeof n[t]&&delete n[t]};addDictKey=function(n,t){"undefined"!=typeof n&&(n[t]=!0)};$.fn.scrollBottom=function(){return this.scrollTop()+this.height()};$.fn.refresh=function(){return $(this.selector)};var txt=$("#js-typearea"),hiddenDiv=$(document.createElement("div")),colSiderightClient=$(".wz-sideright-client"),colSiderightTicket=$(".wz-sideright-ticket"),colSiderightAgent=$(".wz-sideright-agent"),colSiderightPayment=$(".wz-sideright-payment"),$colSideright=$("#wz-col-sideright"),$colCentral=$(".wz-col-central"),phoneInput=$(".js-customer-input"),channelInput=$(".js-channel-input"),agentInput=$(".js-agent-input"),threadInput=$(".js-thread-input"),$emojiBtn=$("#emoji-btn"),finder=$("#wz-finder"),inputFinder=$("#wz-finder input"),openF=$(".js-open-wz-finder"),closeF=$(".js-close-wz-finder"),finder2=$("#wz-sl2-finder"),inputFinder2=$("#wz-sl2-finder input"),openF2=$(".js-open-wz-sl2-finder"),closeF2=$(".js-close-wz-sl2-finder"),$topBarOption=$(".js-topbar-option"),$topBarModals=$("#wz-modal-clients, #wz-modal-reports, #wz-modal-bots-contact, #wz-modal-automations, #wz-modal-ronin-manager"),$topBarChats=$(".js-topbar-chats"),$topBarSettings=$(".js-topbar-settings"),$topBarRoninManager=$(".js-topbar-ronin-manager"),audio=document.getElementById("wz-notification-audio");audio&&(audio.volume=.2);var notificationsList=$(".js-notifications-list"),notificationTemplate=$(".js-loadtemplate-notification"),iconBell=$(".icon-bell.js-bell"),submitImg=$("#wz-modal-upload-image .js-submit-image"),resetImg=$("#wz-modal-upload-image .js-reset-image"),buttonOpenGallery=$("#wz-modal-upload-image .js-open-image-gallery"),selectImgGallery=$("#wz-modal-image-gallery .js-select-image-done"),cancelImgGallery=$("#wz-modal-upload-image .cancel"),sendForm=$("#send_form"),modalImgGallery=$("#wz-modal-image-gallery"),modalImg=$("#wz-modal-upload-image"),inputModalMessageTag=$("#input-modal-message-tag"),txtImage=$(".js-image-caption-text"),modalFormImageUpload=$(".js-form-image-upload"),inputMessageTag=$("#js-input-message-tag"),inputImageFlags=$(".js-image-flags"),inputImageUrls=$(".js-image-urls"),$modalFullImage=$("#wz-modal-full-image"),ticketSelect=$(".js-tickets-select"),showTicketList=$(".js-show-tickets-list"),ticketsList=$("#wz-modal-tickets"),modalAddTicket=$("#wz-modal-add-ticket"),modalTicket=$("#wz-modal-ticket"),lastTicket=$(".js-last-ticket"),ticketTemplate=$(".js-loadtemplate-ticket"),ticketsAssignationSelect=$(".js-tickets-assignation-select"),tabTickets=$(".js-tab-tickets"),ticketsResponsabilitySelect=$(".js-responsability-tickets-select"),ticketsStatusSelect=$(".js-status-ticket-select"),selectResponsability=$(".js-select-responsability"),selectStatus=$(".js-select-status"),selectResponsability=$(".js-select-responsability"),modalAddShortcut=$("#wz-modal-add-shortcut"),modalShortcuts=$("#wz-modal-shortcuts"),shorcutBtnContainer=$("#send_form .upper .shortcuts"),$sideLeft1=$(".wz-col-sideleft-1"),$sideLeft2=$(".wz-col-sideleft-2"),$sideLeft3=$(".wz-col-sideleft-3"),$addChannel=$(".js-add-channel"),$addAgent=$(".js-add-agent"),$channelTemplate=$(".js-loadtemplate-channel"),$agentTemplate=$(".js-loadtemplate-agent"),chatList=$(".js-list-chat"),chatsSelect=$(".js-chats-select"),chatsStatusSelect=$(".js-status-user-select"),tabChats=$(".js-tab-chats"),selectClient=$(".js-select-client"),selectTicket=$(".js-select-ticket"),viewCurrentTicket=$(".js-view-current"),unreadCurrent=$(".js-unread-current"),archiveCurrent=$(".js-archive-current"),archiveCurrentOption=$(".js-archive-current ul li"),openCurrent=$(".js-open-current"),sendStatus=$("#send_form .status"),checkNote=$("#js-button-checknote"),$messageTemplate=$(".js-loadtemplate-message"),$messageTemplateAgent=$(".js-loadtemplate-message-agent"),$messageTemplateImage=$(".js-loadtemplate-messageImage"),$messageTemplateMultipleImages=$(".js-loadtemplate-messageMultipleImages"),$messageTemplateAudio=$(".js-loadtemplate-messageAudio"),$messageTemplateDocument=$(".js-loadtemplate-messageFile"),$messageTemplateVideo=$(".js-loadtemplate-messageVideo"),$messageTemplateEmail=$(".js-loadtemplate-messageEmail"),$messageTemplateFullImage=$(".js-loadtemplate-messageFullImage"),$messageTemplateNote=$(".js-loadtemplate-note"),$messageTemplateZami=$(".js-loadtemplate-messageZami"),$messageTemplateDialog=$(".js-loadtemplate-dialog"),$deleteMessageDropdown=$(".js-loadtemplate-delconfirm"),$messageTemplateTrash=$(".js-loadtemplate-trash"),inputImage=$("#id_images"),inputAudio=$("#js-input-audio"),buttonSendimage=$("#js-button-sendimage"),buttonSendimageA=$("#js-button-sendimage a"),buttonSendaudio=$("#js-button-sendaudio"),fillerMessageList=$(".js-filler-chat"),messageListContainer=$(".wz-col-central section.main section"),olderMessagesLoader=$(".js-see-older-chats"),modalAddAlert=$("#wz-modal-add-alert"),disconnectionAlert=$("#wz-disconnection-alert"),disconnectionTemplate=$(".js-loadtemplate-disconnection"),modalAddNote=$("#wz-modal-add-note"),emptyCol02=$(".wz-col-sideleft-2 .empty-state"),searchContactContainer=$(".wz-col-sideleft-2 .wz-sideleft2-search"),closeContact=$(".wz-col-sideleft-2  .js-close-wz-column"),openContact=$(".wz-col-sideleft-3 .js-open-wz-column"),contactList=$(".js-list-contacts"),conversationList=$(".js-list-conversations"),contactListContainer=$(".wz-col-sideleft-2 section section"),conversationListContainer=$(".wz-col-sideleft-3 section section"),conversationTemplate=$(".js-loadtemplate-conversation");contactTemplate=$(".js-loadtemplate-contact");listContactsLi=$(".js-list-contacts li");olderContactsLoader=$(".js-see-older-contacts");fillerContactList=$(".js-filler-contact");modalEditUser=$("#wz-modal-edit-user");$assignTemplate=$(".js-loadtemplate-assign");modalPaymentGenerator=$("#wz-modal-payment-generator");modalGallery=$("#wz-modal-gallery");autoresponsesModal=$("#wz-modal-responses");editAutoresponseModal=$("#wz-modal-edit-response");customersModal=$("#wz-modal-clients");reportsModal=$("#wz-modal-reports");pricingSwich=$(".js-pricing-switch");pricingRoninTotal=$(".js-pricing-ronin-total");pricingTelegram=$(".js-pricing-telegram");pricingWhatsapp=$(".js-pricing-whatsapp");pricingFacebook=$(".js-pricing-facebook");pricingSmooch=$(".js-pricing-smooch");pricingModal=$("#wz-modal-pricing");pricingSelectPlan=$(".js-pricing-select-plan");QRCodeModal=$("#wz-modal-qrcode");QRCodeContainer=$("#qrcode-container");QRCodeChannelIcon=$(".js-modal-qrcode-channel-icon");QRCodeChannelName=$(".js-modal-qrcode-channel-name");QRCodeModalClose=$(".js-modal-qrcode-close");QRModalPreloader=$("#wz-modal-qrcode-preload");QRModalPreloading=$(".js-qr-preloader");QRModalSuccess=$(".js-qr-success");accountLockedModal=$("#wz-modal-account-locked");$notificationModal=$("#wz-modal-notification");$notificationModalIcon=$("#wz-modal-notification .js-modalnot-icon");$notificationModalTitle=$("#wz-modal-notification .js-modalnot-title");$notificationModalMessage=$("#wz-modal-notification .js-modalnot-message");$notificationModalButtons=$("#wz-modal-notification .js-modalnot-buttons");$notificationModalSection=$("#wz-modal-notification section");$notificationModalCloseIcon=$("#wz-modal-notification header button");$notificationModalSeparator=$("#wz-modal-notification .wz-separator");welcomeModal=$("#wz-modal-welcome");settingsModal=$("#wz-modal-clients");settingsUser=$("#user-settings");settingsBrand=$("#company-settings");settingsChannels=$("#channel-settings");settingsAgents=$("#agent-settings");showRonin=$(".js-open-ronin");roninModal=$("#wz-modal-ronin");automationsModal=$("#wz-modal-automations");botsContactModal=$("#wz-modal-bots-contact");roninManagerModal=$("#wz-modal-ronin-manager");var $blockTemplateMenuLight,$blockTemplateMenuHeavy,$blockTemplateSubmenu,$blockTemplateTextarea,$blockTemplateOptions,$sideleft1Scroll=$("#sideleft1-scroll"),$sideleft2Scroll=$("#sideleft2-scroll"),$sideleft3Scroll=$("#sideleft3-scroll"),$centralScroll=$("#central-scroll"),siderightScrollSelector="#wz-col-sideright .js-perfect-scroll",$siderightScroll=$(siderightScrollSelector),$leftNavigation=$("#left-navigation");